<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><meta charset="utf-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><meta name="description" content="tidy_xlsx() is deprecated.  Please use xlsx_cells() or xlsx_formats()
instead.
tidy_xlsx() imports data from spreadsheets without coercing it into a
rectangle.  Each cell is represented by a row in a data frame, giving the
cell's address, contents, formula, height, width, and keys to look up the
cell's formatting in an adjacent data structure within the list returned by
this function."><title>Import xlsx (Excel) cell contents into a tidy structure. — tidy_xlsx • tidyxl</title><script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><link href="../deps/bootstrap-5.2.2/bootstrap.min.css" rel="stylesheet"><script src="../deps/bootstrap-5.2.2/bootstrap.bundle.min.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous"><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous"><!-- bootstrap-toc --><script src="https://cdn.jsdelivr.net/gh/afeld/bootstrap-toc@v1.0.1/dist/bootstrap-toc.min.js" integrity="sha256-4veVQbu7//Lk5TSmc7YV48MxtMy98e26cf5MrgZYnwo=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- search --><script src="https://cdnjs.cloudflare.com/ajax/libs/fuse.js/6.4.6/fuse.js" integrity="sha512-zv6Ywkjyktsohkbp9bb45V6tEMoWhzFzXis+LrMehmJZZSys19Yxf1dopHx7WzIKxr5tK2dVcYmaCk2uqdjF4A==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/autocomplete.js/0.38.0/autocomplete.jquery.min.js" integrity="sha512-GU9ayf+66Xx2TmpxqJpliWbT5PiGYxpaG8rfnBEk1LL8l1KGkRShhngwdXK1UgqhAzWpZHSiYPc09/NwDQIGyg==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mark.js/8.11.1/mark.min.js" integrity="sha512-5CYOlHXGh6QpOFA/TeTylKLWfB3ftPsde7AnmhuitiTX4K5SqCLBeKro6sPS8ilsz1Q4NRx3v8Ko2IBiszzdww==" crossorigin="anonymous"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="Import xlsx (Excel) cell contents into a tidy structure. — tidy_xlsx"><meta property="og:description" content="tidy_xlsx() is deprecated.  Please use xlsx_cells() or xlsx_formats()
instead.
tidy_xlsx() imports data from spreadsheets without coercing it into a
rectangle.  Each cell is represented by a row in a data frame, giving the
cell's address, contents, formula, height, width, and keys to look up the
cell's formatting in an adjacent data structure within the list returned by
this function."><!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]--></head><body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>
    

    <nav class="navbar fixed-top navbar-light navbar-expand-lg bg-light"><div class="container">
    
    <a class="navbar-brand me-2" href="../index.html">tidyxl</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">1.0.8</small>

    
    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto"><li class="nav-item">
  <a class="nav-link" href="../articles/tidyxl.html">Get started</a>
</li>
<li class="active nav-item">
  <a class="nav-link" href="../reference/index.html">Reference</a>
</li>
<li class="nav-item dropdown">
  <a href="#" class="nav-link dropdown-toggle" data-bs-toggle="dropdown" role="button" aria-expanded="false" aria-haspopup="true" id="dropdown-articles">Articles</a>
  <div class="dropdown-menu" aria-labelledby="dropdown-articles">
    <a class="dropdown-item" href="../articles/data-validation-rules.html">Data Validation Rules</a>
    <a class="dropdown-item" href="../articles/smells.html">Detecting Spreadsheet Smells with xlex()</a>
  </div>
</li>
<li class="nav-item">
  <a class="nav-link" href="../news/index.html">Changelog</a>
</li>
      </ul><form class="form-inline my-2 my-lg-0" role="search">
        <input type="search" class="form-control me-sm-2" aria-label="Toggle navigation" name="search-input" data-search-index="../search.json" id="search-input" placeholder="Search for" autocomplete="off"></form>

      <ul class="navbar-nav"><li class="nav-item">
  <a class="external-link nav-link" href="https://github.com/nacnudus/tidyxl/" aria-label="github">
    <span class="fab fa fab fa-github fa-lg"></span>
     
  </a>
</li>
      </ul></div>

    
  </div>
</nav><div class="container template-reference-topic">
<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">
      <img src="" class="logo" alt=""><h1>Import xlsx (Excel) cell contents into a tidy structure.</h1>
      <small class="dont-index">Source: <a href="https://github.com/nacnudus/tidyxl/blob/HEAD/R/tidy_xlsx.R" class="external-link"><code>R/tidy_xlsx.R</code></a></small>
      <div class="d-none name"><code>tidy_xlsx.Rd</code></div>
    </div>

    <div class="ref-description section level2">
    <p><code>tidy_xlsx()</code> is deprecated.  Please use <code><a href="xlsx_cells.html">xlsx_cells()</a></code> or <code><a href="xlsx_formats.html">xlsx_formats()</a></code>
instead.</p>
<p><code>tidy_xlsx()</code> imports data from spreadsheets without coercing it into a
rectangle.  Each cell is represented by a row in a data frame, giving the
cell's address, contents, formula, height, width, and keys to look up the
cell's formatting in an adjacent data structure within the list returned by
this function.</p>
    </div>

    <div class="section level2">
    <h2 id="ref-usage">Usage<a class="anchor" aria-label="anchor" href="#ref-usage"></a></h2>
    <div class="sourceCode"><pre class="sourceCode r"><code><span><span class="fu">tidy_xlsx</span><span class="op">(</span><span class="va">path</span>, sheets <span class="op">=</span> <span class="cn">NA</span><span class="op">)</span></span></code></pre></div>
    </div>

    <div class="section level2">
    <h2 id="arguments">Arguments<a class="anchor" aria-label="anchor" href="#arguments"></a></h2>
    <dl><dt>path</dt>
<dd><p>Path to the xlsx file.</p></dd>


<dt>sheets</dt>
<dd><p>Sheets to read. Either a character vector (the names of the
sheets), an integer vector (the positions of the sheets), or NA (default, all
sheets).</p></dd>

</dl></div>
    <div class="section level2">
    <h2 id="value">Value<a class="anchor" aria-label="anchor" href="#value"></a></h2>
    

<p>A list of the data within each sheet (<code>$data</code>), and the formatting applied to
each cell (<code>$formats</code>).</p>


<p>Each sheet's data is returned as a data frames, one per sheet, by the sheet
name.  For example, the data in a sheet named 'My Worksheet' is in
x$data$<code>My Worksheet</code>.  Each data frame has the following
columns:</p><ul><li><p><code>address</code> The cell address in A1 notation.</p></li>
<li><p><code>row</code> The row number of a cell address (integer).</p></li>
<li><p><code>col</code> The column number of a cell address (integer).</p></li>
<li><p><code>is_blank</code> Whether or not the cell has a value</p></li>
<li><p><code>data_type</code> The type of a cell, referring to the following columns:
error, logical, numeric, date, character, blank.</p></li>
<li><p><code>error</code> The error value of a cell.</p></li>
<li><p><code>logical</code> The boolean value of a cell.</p></li>
<li><p><code>numeric</code> The numeric value of a cell.</p></li>
<li><p><code>date</code> The date value of a cell.</p></li>
<li><p><code>character</code> The string value of a cell.</p></li>
<li><p><code>character_formatted</code> A data frame of substrings and their individual
formatting.</p></li>
<li><p><code>formula</code> The formula in a cell (see 'Details').</p></li>
<li><p><code>is_array</code> Whether or not the formula is an array formula.</p></li>
<li><p><code>formula_ref</code> The address of a range of cells group to which an array
formula or shared formula applies (see 'Details').</p></li>
<li><p><code>formula_group</code> The formula group to which the cell belongs (see
'Details').</p></li>
<li><p><code>comment</code> The text of a comment attached to a cell.</p></li>
<li><p><code>height</code> The height of a cell's row, in Excel's units.</p></li>
<li><p><code>width</code> The width of a cell's column, in Excel's units.</p></li>
<li><p><code>style_format</code> An index into a table of style formats
<code>x$formats$style</code> (see 'Details').</p></li>
<li><p><code>local_format_id</code> An index into a table of local cell formats
<code>x$formats$local</code> (see 'Details').</p></li>
</ul><div class="section">
<h3 id="formula">Formula<a class="anchor" aria-label="anchor" href="#formula"></a></h3>
<p>When a cell has a formula, the value in the 'content' column is the result
of the formula the last time it was evaluated.</p>
<p>Certain groups of cells may share a formula that differs only by addresses
referred to in the formula; such groups are identified by an index, the
'formula_group'.  The xlsx (Excel) file format only records the formula
against one cell in any group.  <code><a href="xlsx_cells.html">xlsx_cells()</a></code> propagates such formulas to
the other cells in a group, making the necessary changes to relative
addresses in the formula.</p>
<p>Array formulas may also apply to a group of cells, identified by an address
'formula_ref', but xlsx (Excel) file format only records the formula
against one cell in the group.  <code><a href="xlsx_cells.html">xlsx_cells()</a></code> propagates such formulas to
the other cells in a group.  Unlike shared formulas, no changes to
addresses in array formulas are necessary.</p>
<p>Formulas that refer to other workbooks currently do not name the workbooks
directly, instead via indices such as <code>[1]</code>.  It is planned to
dereference these.</p>
</div>



<div class="section">
<h3 id="formatting">Formatting<a class="anchor" aria-label="anchor" href="#formatting"></a></h3>
<p>Cell formatting is returned in <code>x$formats</code>.  There are two types or scopes
of formatting: 'style' formatting, such as Excel's built-in styles
'normal', 'bad', etc., and 'local' formatting, which overrides particular
elements of the style, e.g. by making it bold.  Both types of  are returned
in <code>x$formats$style</code> and <code>x$formats$local</code>, with identical structures.  To
look up the local formatting of a given cell, take the cell's
'local_format_id' value (<code>x$data$Sheet1[1, "local_format_id"]</code>), and use it
as an index into the format structure.  E.g. to look up the font size,
<code>x$formats$local$font$size[local_format_id]</code>.  To see all available
formats, type <code>str(x$formats$local)</code>.</p>
<p>Colours may be recorded in any of three ways: a hexadecimal RGB string with
or without alpha, an 'indexed' colour, and an index into a 'theme'.
<code>tidy_xlsx</code> dereferences 'indexed' and 'theme' colours to their hexadecimal
RGB string representation, and standardises all RGB strings to have an
alpha channel in the first two characters.  The 'index' and the 'theme'
name are still provided.  To filter by an RGB string, you could  look up
the RGB values in a spreadsheet program (e.g. Excel, LibreOffice,
Gnumeric), and use the <code><a href="https://rdrr.io/r/grDevices/rgb.html" class="external-link">grDevices::rgb()</a></code> function to convert these to a
hexadecimal string.  Put the alpha value in first, e.g.</p>
<p></p><div class="sourceCode"><pre><code><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a>A <span class="ot">&lt;-</span> <span class="dv">1</span>; R <span class="ot">&lt;-</span> <span class="fl">0.5</span>; G <span class="ot">&lt;-</span> <span class="dv">0</span>; B <span class="ot">&lt;-</span> <span class="dv">0</span></span>
<span id="cb1-2"><a href="#cb1-2" aria-hidden="true" tabindex="-1"></a><span class="fu">rgb</span>(A, R, G, B)</span>
<span id="cb1-3"><a href="#cb1-3" aria-hidden="true" tabindex="-1"></a><span class="co"># [1] "#FF800000"</span></span></code></pre><p></p></div>
<p>Strings can be formatted within a cell, so that a single cell can contain
substrings with different formatting.  This in-cell formatting is available
in the column <code>character_formatted</code>, which is a list-column of data frames.
Each row of each data frame describes a substring and its formatting.  For
cells without a character value, <code>character_formatted</code> is <code>NULL</code>, so for
further processing you might need to filter out the <code>NULL</code>s first.</p>
</div>


    </div>
    <div class="section level2">
    <h2 id="details">Details<a class="anchor" aria-label="anchor" href="#details"></a></h2>
    <p>A cell has two 'values': its content, and sometimes also a formula.  It also
has formatting applied at the 'style' level, which can be locally overridden.</p>
<div class="section">
<h3 id="content">Content<a class="anchor" aria-label="anchor" href="#content"></a></h3>
<p>Depending on the cell, the content may be a numeric value such as 365 or
365.25, it may represent a date/datetime in one of Excel's date/datetime
systems, or it may be an index into an internal table of strings.
<code>tidy_xlsx()</code> attempts to infer the correct data type of each cell,
returning its value in the appropriate column (error, logical, numeric,
date, character). In case this cleverness is unhelpful, the unparsed value
and type information is available in the 'content' and 'type' columns.</p>
</div>

<div class="section">
<h3 id="formula-1">Formula<a class="anchor" aria-label="anchor" href="#formula-1"></a></h3>
<p>When a cell has a formula, the value in the 'content' column is the result
of the formula the last time it was evaluated.</p>
<p>Certain groups of cells may share a formula that differs only by addresses
referred to in the formula; such groups are identified by an index, the
'formula_group'.  The xlsx (Excel) file format only records the formula
against one cell in any group, but <code>tidy_xlsx()</code> propagates the formula to
all the cells in the group, making the necessary changes to relative
addresses in the formula.</p>
<p>Array formulas may also apply to a group of cells, identified by an address
'formula_ref', but xlsx (Excel) file format only records the formula
against one cell in the group.  Unlike ordinary formulas, <code>tidy_xlsx()</code>
does not propagate these to the other cells in the group.</p>
<p>Formulas that refer to other workbooks currently do not name the workbooks
directly, instead via indices such as <code>[1]</code>.  It is planned to
dereference these.</p>
</div>

<div class="section">
<h3 id="formatting-1">Formatting<a class="anchor" aria-label="anchor" href="#formatting-1"></a></h3>
<p>Cell formatting is returned in <code>x$formats</code>.  There are two types of
formatting: 'style' formatting, such as Excel's built-in styles 'normal',
'bad', etc., and 'local' formatting, which overrides the style.  These are
returned in <code>x$formats$style</code> and <code>x$formats$local</code>, with
identical structures.  To look up the local formatting of a given cell,
take the cell's 'local_format_id' value (<code>x$data$Sheet1[1, "local_format_id"]</code>), and use it as an index into the format structure.
E.g. to look up the font size,
<code>x$formats$local$font$size[local_format_id]</code>.  To see all available
formats, type <code>str(x$formats$local)</code>.</p>
</div>

    </div>

    <div class="section level2">
    <h2 id="ref-examples">Examples<a class="anchor" aria-label="anchor" href="#ref-examples"></a></h2>
    <div class="sourceCode"><pre class="sourceCode r"><code><span class="r-in"><span><span class="kw">if</span> <span class="op">(</span><span class="cn">FALSE</span><span class="op">)</span> <span class="op">{</span></span></span>
<span class="r-in"><span><span class="va">examples</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/system.file.html" class="external-link">system.file</a></span><span class="op">(</span><span class="st">"extdata/examples.xlsx"</span>, package <span class="op">=</span> <span class="st">"tidyxl"</span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># All sheets</span></span></span>
<span class="r-in"><span><span class="fu"><a href="https://rdrr.io/r/utils/str.html" class="external-link">str</a></span><span class="op">(</span><span class="fu">tidy_xlsx</span><span class="op">(</span><span class="va">examples</span><span class="op">)</span><span class="op">$</span><span class="va">data</span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># Specific sheet either by position or by name</span></span></span>
<span class="r-in"><span><span class="fu"><a href="https://rdrr.io/r/utils/str.html" class="external-link">str</a></span><span class="op">(</span><span class="fu">tidy_xlsx</span><span class="op">(</span><span class="va">examples</span>, <span class="fl">2</span><span class="op">)</span><span class="op">$</span><span class="va">data</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="fu"><a href="https://rdrr.io/r/utils/str.html" class="external-link">str</a></span><span class="op">(</span><span class="fu">tidy_xlsx</span><span class="op">(</span><span class="va">examples</span>, <span class="st">"Sheet1"</span><span class="op">)</span><span class="op">$</span><span class="va">data</span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># Data (cell values)</span></span></span>
<span class="r-in"><span><span class="va">x</span> <span class="op">&lt;-</span> <span class="fu">tidy_xlsx</span><span class="op">(</span><span class="va">examples</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="fu"><a href="https://rdrr.io/r/utils/str.html" class="external-link">str</a></span><span class="op">(</span><span class="va">x</span><span class="op">$</span><span class="va">data</span><span class="op">$</span><span class="va">Sheet1</span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># Formatting</span></span></span>
<span class="r-in"><span><span class="fu"><a href="https://rdrr.io/r/utils/str.html" class="external-link">str</a></span><span class="op">(</span><span class="va">x</span><span class="op">$</span><span class="va">formats</span><span class="op">$</span><span class="va">local</span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># The formats of particular cells can be retrieved like this:</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="va">Sheet1</span> <span class="op">&lt;-</span> <span class="va">x</span><span class="op">$</span><span class="va">data</span><span class="op">$</span><span class="va">Sheet1</span></span></span>
<span class="r-in"><span><span class="va">x</span><span class="op">$</span><span class="va">formats</span><span class="op">$</span><span class="va">style</span><span class="op">$</span><span class="va">font</span><span class="op">$</span><span class="va">bold</span><span class="op">[</span><span class="va">Sheet1</span><span class="op">$</span><span class="va">style_format</span><span class="op">]</span></span></span>
<span class="r-in"><span><span class="va">x</span><span class="op">$</span><span class="va">formats</span><span class="op">$</span><span class="va">local</span><span class="op">$</span><span class="va">font</span><span class="op">$</span><span class="va">bold</span><span class="op">[</span><span class="va">Sheet1</span><span class="op">$</span><span class="va">local_format_id</span><span class="op">]</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># To filter for cells of a particular format, first filter the formats to get</span></span></span>
<span class="r-in"><span><span class="co"># the relevant indices, and then filter the cells by those indices.</span></span></span>
<span class="r-in"><span><span class="va">bold_indices</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/which.html" class="external-link">which</a></span><span class="op">(</span><span class="va">x</span><span class="op">$</span><span class="va">formats</span><span class="op">$</span><span class="va">local</span><span class="op">$</span><span class="va">font</span><span class="op">$</span><span class="va">bold</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="va">Sheet1</span><span class="op">[</span><span class="va">Sheet1</span><span class="op">$</span><span class="va">local_format_id</span> <span class="op"><a href="https://rdrr.io/r/base/match.html" class="external-link">%in%</a></span> <span class="va">bold_indices</span>, <span class="op">]</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># In-cell formatting is available in the `character_formatted` column as a</span></span></span>
<span class="r-in"><span><span class="co"># data frame, one row per substring.</span></span></span>
<span class="r-in"><span><span class="fu">tidy_xlsx</span><span class="op">(</span><span class="va">examples</span><span class="op">)</span><span class="op">$</span><span class="va">data</span><span class="op">$</span><span class="va">Sheet1</span><span class="op">$</span><span class="va">character_formatted</span><span class="op">[</span><span class="fl">77</span><span class="op">]</span></span></span>
<span class="r-in"><span><span class="op">}</span></span></span>
</code></pre></div>
    </div>
  </main><aside class="col-md-3"><nav id="toc"><h2>On this page</h2>
    </nav></aside></div>


    <footer><div class="pkgdown-footer-left">
  <p></p><p>Developed by Duncan Garmonsway.</p>
</div>

<div class="pkgdown-footer-right">
  <p></p><p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.0.7.</p>
</div>

    </footer></div>

  

  

  </body></html>

