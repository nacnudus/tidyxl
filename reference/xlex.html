<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><meta charset="utf-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><meta name="description" content="xlex takes an Excel formula and separates it into tokens.  The name is
a bad pun on 'Excel' and 'lexer'.  It returns a dataframe, one row per token,
giving the token itself, its type (e.g.  number, or error), and its
level.
The level is a number to show the depth of a token within nested function
calls.  The token A2 in the formula IF(A1=1,A2,MAX(A3,A4)) is at level 1.
Tokens A3 and A4 are at level 2.  The token IF is at level 0, which is
the outermost level.
The output isn't enough to enable computation or validation of formulas, but
it is enough to investigate the structure of formulas and spreadsheets.  It
has been tested on millions of formulas in the Enron corpus."><title>Parse xlsx (Excel) formulas into tokens — xlex • tidyxl</title><script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><link href="../deps/bootstrap-5.1.3/bootstrap.min.css" rel="stylesheet"><script src="../deps/bootstrap-5.1.3/bootstrap.bundle.min.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous"><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous"><!-- bootstrap-toc --><script src="https://cdn.rawgit.com/afeld/bootstrap-toc/v1.0.1/dist/bootstrap-toc.min.js"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- search --><script src="https://cdnjs.cloudflare.com/ajax/libs/fuse.js/6.4.6/fuse.js" integrity="sha512-zv6Ywkjyktsohkbp9bb45V6tEMoWhzFzXis+LrMehmJZZSys19Yxf1dopHx7WzIKxr5tK2dVcYmaCk2uqdjF4A==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/autocomplete.js/0.38.0/autocomplete.jquery.min.js" integrity="sha512-GU9ayf+66Xx2TmpxqJpliWbT5PiGYxpaG8rfnBEk1LL8l1KGkRShhngwdXK1UgqhAzWpZHSiYPc09/NwDQIGyg==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mark.js/8.11.1/mark.min.js" integrity="sha512-5CYOlHXGh6QpOFA/TeTylKLWfB3ftPsde7AnmhuitiTX4K5SqCLBeKro6sPS8ilsz1Q4NRx3v8Ko2IBiszzdww==" crossorigin="anonymous"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="Parse xlsx (Excel) formulas into tokens — xlex"><meta property="og:description" content="xlex takes an Excel formula and separates it into tokens.  The name is
a bad pun on 'Excel' and 'lexer'.  It returns a dataframe, one row per token,
giving the token itself, its type (e.g.  number, or error), and its
level.
The level is a number to show the depth of a token within nested function
calls.  The token A2 in the formula IF(A1=1,A2,MAX(A3,A4)) is at level 1.
Tokens A3 and A4 are at level 2.  The token IF is at level 0, which is
the outermost level.
The output isn't enough to enable computation or validation of formulas, but
it is enough to investigate the structure of formulas and spreadsheets.  It
has been tested on millions of formulas in the Enron corpus."><!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]--><!-- Global site tag (gtag.js) - Google Analytics --><script async src="https://www.googletagmanager.com/gtag/js?id=UA-45097885-4"></script><script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());

  gtag('config', 'UA-45097885-4');
</script></head><body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>
    

    <nav class="navbar fixed-top navbar-light navbar-expand-lg bg-light"><div class="container">
    
    <a class="navbar-brand me-2" href="../index.html">tidyxl</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">1.0.7.9000</small>

    
    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto"><li class="nav-item">
  <a class="nav-link" href="../articles/tidyxl.html">Get started</a>
</li>
<li class="active nav-item">
  <a class="nav-link" href="../reference/index.html">Reference</a>
</li>
<li class="nav-item dropdown">
  <a href="#" class="nav-link dropdown-toggle" data-bs-toggle="dropdown" role="button" aria-expanded="false" aria-haspopup="true" id="dropdown-articles">Articles</a>
  <div class="dropdown-menu" aria-labelledby="dropdown-articles">
    <a class="dropdown-item" href="../articles/data-validation-rules.html">Data Validation Rules</a>
    <a class="dropdown-item" href="../articles/smells.html">Detecting Spreadsheet Smells with xlex()</a>
  </div>
</li>
<li class="nav-item">
  <a class="nav-link" href="../news/index.html">Changelog</a>
</li>
      </ul><form class="form-inline my-2 my-lg-0" role="search">
        <input type="search" class="form-control me-sm-2" aria-label="Toggle navigation" name="search-input" data-search-index="../search.json" id="search-input" placeholder="Search for" autocomplete="off"></form>

      <ul class="navbar-nav"><li class="nav-item">
  <a class="external-link nav-link" href="https://github.com/nacnudus/tidyxl/" aria-label="github">
    <span class="fab fa fab fa-github fa-lg"></span>
     
  </a>
</li>
      </ul></div>

    
  </div>
</nav><div class="container template-reference-topic">
<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">
      <img src="" class="logo" alt=""><h1>Parse xlsx (Excel) formulas into tokens</h1>
      <small class="dont-index">Source: <a href="https://github.com/nacnudus/tidyxl/blob/HEAD/R/xlex.R" class="external-link"><code>R/xlex.R</code></a></small>
      <div class="d-none name"><code>xlex.Rd</code></div>
    </div>

    <div class="ref-description section level2">
    <p><code>xlex</code> takes an Excel formula and separates it into tokens.  The name is
a bad pun on 'Excel' and 'lexer'.  It returns a dataframe, one row per token,
giving the token itself, its type (e.g.  <code>number</code>, or <code>error</code>), and its
level.</p>
<p>The level is a number to show the depth of a token within nested function
calls.  The token <code>A2</code> in the formula <code>IF(A1=1,A2,MAX(A3,A4))</code> is at level 1.
Tokens <code>A3</code> and <code>A4</code> are at level 2.  The token <code>IF</code> is at level 0, which is
the outermost level.</p>
<p>The output isn't enough to enable computation or validation of formulas, but
it is enough to investigate the structure of formulas and spreadsheets.  It
has been tested on millions of formulas in the Enron corpus.</p>
    </div>

    <div class="section level2">
    <h2 id="ref-usage">Usage<a class="anchor" aria-label="anchor" href="#ref-usage"></a></h2>
    <div class="sourceCode"><pre class="sourceCode r"><code><span><span class="fu">xlex</span><span class="op">(</span><span class="va">x</span><span class="op">)</span></span></code></pre></div>
    </div>

    <div class="section level2">
    <h2 id="arguments">Arguments<a class="anchor" aria-label="anchor" href="#arguments"></a></h2>
    <dl><dt>x</dt>
<dd><p>Character vector of length 1, giving the formula.</p></dd>

</dl></div>
    <div class="section level2">
    <h2 id="value">Value<a class="anchor" aria-label="anchor" href="#value"></a></h2>
    

<p>A data frame (a tibble, if you use the tidyverse) one row per token,
giving the token itself, its type (e.g.  <code>number</code>, or <code>error</code>), and its
level.</p>


<p>A class attribute <code>xlex</code> is added, so that the <code><a href="https://rdrr.io/r/base/print.html" class="external-link">base::print()</a></code> generic can be
specialised to print the tree prettily.</p>
    </div>
    <div class="section level2">
    <h2 id="details">Details<a class="anchor" aria-label="anchor" href="#details"></a></h2>
    <p>The different types of tokens are:</p><ul><li><p><code>ref</code> A cell reference/address e.g. <code>A1</code> or <code>$B2:C$14</code>.</p></li>
<li><p><code>sheet</code>A sheet name, e.g. <code>Sheet1!</code> or <code>'My Sheet'!</code>.  If the sheet is
from a different file, then the file is included in this token -- usually
it has been normalized to the form <code>[0]</code>.</p></li>
<li><p><code>name</code> A named range, or more properly a named formula.</p></li>
<li><p><code>function</code> An Excel or user-defined function, e.g. <code>MAX</code> or
<code>_xll.MY_CUSTOM_FUNCTION</code>.  A complete list of official Excel functions is
available in the vector <code><a href="excel_functions.html">excel_functions</a></code>.</p></li>
<li><p><code>error</code> An error, e.g. <code>#N/A</code> or <code>#REF!</code>.</p></li>
<li><p><code>bool</code> <code>TRUE</code> or <code>FALSE</code> -- note that there are also functions <code>TRUE()</code> and
<code>FALSE()</code>.</p></li>
<li><p><code>number</code> All forms of numbers, e.g. <code>1</code>, <code>1.1</code>, <code>-1</code>, <code>1.2E3</code>.</p></li>
<li><p><code>text</code> Strings inside double quotes, e.g. <code>"Hello, World!"</code>.</p></li>
<li><p><code>operator</code> The usual infix operators, <code>+</code>, <code>-</code>, <code>*</code>, <code>/</code>, <code>^</code>, <code>&lt;</code>, <code>&lt;=</code>,
<code>&lt;&gt;</code>, etc.  and also the range operator <code>:</code> when it is used with ranges
that aren't cell addresses, e.g. <code>INDEX(something):A1</code>. The union operator
<code>,</code> is the same symbol that is used to separate function arguments and
array columns, so it is only tagged <code>operator</code> when it is inside
parentheses that are not function parentheses or array curly braces (see
the examples).</p></li>
<li><p><code>paren_open</code> An open parenthesis <code>(</code> indicating an increase in the level
of nesting, but not directly enclosing function arguments.</p></li>
<li><p><code>paren_close</code> As <code>open</code>, but reducing the level of nesting.</p></li>
<li><p><code>open_array</code> An open curly brace '{' indicating the start of an array
of constants, and an increase in the level of nesting.</p></li>
<li><p><code>close_array</code> As <code>open_array</code>, but ending the array of constants</p></li>
<li><p><code>fun_open</code> An open parenthesis <code>(</code> immediately after a function name,
directly enclosing the function arguments.</p></li>
<li><p><code>fun_close</code> As <code>fun_open</code> but immediately after the function
arguments.</p></li>
<li><p><code>separator</code> A comma <code>,</code> separating function arguments or array
columns, or a semicolon <code>;</code> separating array rows.</p></li>
<li><p><code>DDE</code> A call to a Dynamic Data Exchange server, usually normalized to
the form <code>[1]!'DDE_parameter=1'</code>, but the full form is
<code>'ABCD'|'EFGH'!'IJKL'</code>.</p></li>
<li><p><code>space</code> Some old files haven't stripped formulas of meaningless
spaces. They are returned as <code>space</code> tokens so that the original formula
can always be reconstructed by concatenating all tokens.</p></li>
<li><p><code>other</code> If you see this, then something has gone wrong -- please
report it at https://github.com/nacnudus/tidyxl/issues with a
reproducible example (e.g. using the reprex package).</p></li>
</ul><p>Every part of the original formula is returned as a token, so the original
formula can be reconstructed by concatenating the tokens.  If that doesn't
work, please report it at https://github.com/nacnudus/tidyxl/issues with a
reproducible example (e.g. using the reprex package).</p>
<p>The XLParser project was a great help in creating the grammar.
https://github.com/spreadsheetlab/XLParser.</p>
    </div>

    <div class="section level2">
    <h2 id="ref-examples">Examples<a class="anchor" aria-label="anchor" href="#ref-examples"></a></h2>
    <div class="sourceCode"><pre class="sourceCode r"><code><span class="r-in"><span><span class="co"># All explicit cell references/addresses are returned as a single 'ref' token.</span></span></span>
<span class="r-in"><span><span class="fu">xlex</span><span class="op">(</span><span class="st">"A1"</span><span class="op">)</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span> root    </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> °-- A1  ref </span>
<span class="r-in"><span><span class="fu">xlex</span><span class="op">(</span><span class="st">"A$1"</span><span class="op">)</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span> root     </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> °-- A$1  ref </span>
<span class="r-in"><span><span class="fu">xlex</span><span class="op">(</span><span class="st">"$A1"</span><span class="op">)</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span> root     </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> °-- $A1  ref </span>
<span class="r-in"><span><span class="fu">xlex</span><span class="op">(</span><span class="st">"$A$1"</span><span class="op">)</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span> root      </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> °-- $A$1  ref </span>
<span class="r-in"><span><span class="fu">xlex</span><span class="op">(</span><span class="st">"A1:B2"</span><span class="op">)</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span> root       </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> °-- A1:B2  ref </span>
<span class="r-in"><span><span class="fu">xlex</span><span class="op">(</span><span class="st">"1:1"</span><span class="op">)</span> <span class="co"># Whole row</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span> root     </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> °-- 1:1  ref </span>
<span class="r-in"><span><span class="fu">xlex</span><span class="op">(</span><span class="st">"A:B"</span><span class="op">)</span> <span class="co"># Whole column</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span> root     </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> °-- A:B  ref </span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># If one part of an address is a name or a function, then the colon ':' is</span></span></span>
<span class="r-in"><span><span class="co"># regarded as a 'range operator', so is tagged 'operator'.</span></span></span>
<span class="r-in"><span><span class="fu">xlex</span><span class="op">(</span><span class="st">"A1:SOME.NAME"</span><span class="op">)</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span> root           </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> ¦-- A1         ref</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> ¦-- :          operator</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> °-- SOME.NAME  name </span>
<span class="r-in"><span><span class="fu">xlex</span><span class="op">(</span><span class="st">"SOME_FUNCTION():B2"</span><span class="op">)</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span> root               </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> ¦-- SOME_FUNCTION  function</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> ¦-- (              fun_open</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> ¦-- )              fun_close</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> ¦-- :              operator</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> °-- B2             ref </span>
<span class="r-in"><span><span class="fu">xlex</span><span class="op">(</span><span class="st">"SOME_FUNCTION():SOME.NAME"</span><span class="op">)</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span> root               </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> ¦-- SOME_FUNCTION  function</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> ¦-- (              fun_open</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> ¦-- )              fun_close</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> ¦-- :              operator</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> °-- SOME.NAME      name </span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># Sheet names are recognised by the terminal exclamation mark '!'.</span></span></span>
<span class="r-in"><span><span class="fu">xlex</span><span class="op">(</span><span class="st">"Sheet1!A1"</span><span class="op">)</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span> root         </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> ¦-- Sheet1!  sheet</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> °-- A1       ref </span>
<span class="r-in"><span><span class="fu">xlex</span><span class="op">(</span><span class="st">"'Sheet 1'!A1"</span><span class="op">)</span>       <span class="co"># Quoted names may contain some punctuation</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span> root            </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> ¦-- 'Sheet 1'!  sheet</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> °-- A1          ref </span>
<span class="r-in"><span><span class="fu">xlex</span><span class="op">(</span><span class="st">"'It''s a sheet'!A1"</span><span class="op">)</span> <span class="co"># Quotes are escaped by doubling</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span> root                  </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> ¦-- 'It''s a sheet'!  sheet</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> °-- A1                ref </span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># Sheets can be ranged together in so-called 'three-dimensional formulas'.</span></span></span>
<span class="r-in"><span><span class="co"># Both sheets are returned in a single 'sheet' token.</span></span></span>
<span class="r-in"><span><span class="fu">xlex</span><span class="op">(</span><span class="st">"Sheet1:Sheet2!A1"</span><span class="op">)</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span> root                </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> ¦-- Sheet1:Sheet2!  sheet</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> °-- A1              ref </span>
<span class="r-in"><span><span class="fu">xlex</span><span class="op">(</span><span class="st">"'Sheet 1:Sheet 2'!A1"</span><span class="op">)</span> <span class="co"># Quotes surround both (rather than each) sheet</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span> root                    </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> ¦-- 'Sheet 1:Sheet 2'!  sheet</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> °-- A1                  ref </span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># Sheets from other files are prefixed by the filename, which Excel</span></span></span>
<span class="r-in"><span><span class="co"># normalizes the filenames into indexes.  Either way, xlex() includes the</span></span></span>
<span class="r-in"><span><span class="co"># file/index in the 'sheet' token.</span></span></span>
<span class="r-in"><span><span class="fu">xlex</span><span class="op">(</span><span class="st">"[1]Sheet1!A1"</span><span class="op">)</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span> root            </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> ¦-- [1]Sheet1!  sheet</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> °-- A1          ref </span>
<span class="r-in"><span><span class="fu">xlex</span><span class="op">(</span><span class="st">"'[1]Sheet 1'!A1"</span><span class="op">)</span> <span class="co"># Quotes surround both the file index and the sheet</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span> root               </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> ¦-- '[1]Sheet 1'!  sheet</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> °-- A1             ref </span>
<span class="r-in"><span><span class="fu">xlex</span><span class="op">(</span><span class="st">"'C:\\My Documents\\[file.xlsx]Sheet1'!A1"</span><span class="op">)</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span> root                                      </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> ¦-- 'C:\My Documents\[file.xlsx]Sheet1'!  sheet</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> °-- A1                                    ref </span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># Function names are recognised by the terminal open-parenthesis '('.  There</span></span></span>
<span class="r-in"><span><span class="co"># is no distinction between custom functions and built-in Excel functions.</span></span></span>
<span class="r-in"><span><span class="co"># The open-parenthesis is tagged 'fun_open', and the corresponding</span></span></span>
<span class="r-in"><span><span class="co"># close-parenthesis at the end of the arguments is tagged 'fun_close'.</span></span></span>
<span class="r-in"><span><span class="fu">xlex</span><span class="op">(</span><span class="st">"MAX(1,2)"</span><span class="op">)</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span> root       </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> ¦-- MAX    function</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> °-- (      fun_open</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>     ¦-- 1  number</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>     ¦-- ,  separator</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>     °-- 2  number</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> °-- )      fun_close </span>
<span class="r-in"><span><span class="fu">xlex</span><span class="op">(</span><span class="st">"_xll.MY_CUSTOM_FUNCTION()"</span><span class="op">)</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span> root                         </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> ¦-- _xll.MY_CUSTOM_FUNCTION  function</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> ¦-- (                        fun_open</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> °-- )                        fun_close </span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># Named ranges (properly called 'named formulas') are a last resort after</span></span></span>
<span class="r-in"><span><span class="co"># attempting to match a function (ending in an open parenthesis '(') or a</span></span></span>
<span class="r-in"><span><span class="co"># sheet (ending in an exclamation mark '!')</span></span></span>
<span class="r-in"><span><span class="fu">xlex</span><span class="op">(</span><span class="st">"MY_NAMED_RANGE"</span><span class="op">)</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span> root                </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> °-- MY_NAMED_RANGE  name </span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># Some cell addresses/references, functions and names can look alike, but</span></span></span>
<span class="r-in"><span><span class="co"># xlex() should always make the right choice.</span></span></span>
<span class="r-in"><span><span class="fu">xlex</span><span class="op">(</span><span class="st">"XFD1"</span><span class="op">)</span>     <span class="co"># A cell in the maximum column in Excel</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span> root      </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> °-- XFD1  ref </span>
<span class="r-in"><span><span class="fu">xlex</span><span class="op">(</span><span class="st">"XFE1"</span><span class="op">)</span>     <span class="co"># Beyond the maximum column, must be a named range/formula</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span> root      </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> °-- XFE1  name </span>
<span class="r-in"><span><span class="fu">xlex</span><span class="op">(</span><span class="st">"A1048576"</span><span class="op">)</span> <span class="co"># A cell in the maximum row in Excel</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span> root          </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> °-- A1048576  ref </span>
<span class="r-in"><span><span class="fu">xlex</span><span class="op">(</span><span class="st">"A1048577"</span><span class="op">)</span> <span class="co"># Beyond the maximum row, must be a named range/formula</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span> root          </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> °-- A1048577  name </span>
<span class="r-in"><span><span class="fu">xlex</span><span class="op">(</span><span class="st">"LOG10"</span><span class="op">)</span>    <span class="co"># A cell address</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span> root       </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> °-- LOG10  ref </span>
<span class="r-in"><span><span class="fu">xlex</span><span class="op">(</span><span class="st">"LOG10()"</span><span class="op">)</span>  <span class="co"># A log function</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span> root       </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> ¦-- LOG10  function</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> ¦-- (      fun_open</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> °-- )      fun_close </span>
<span class="r-in"><span><span class="fu">xlex</span><span class="op">(</span><span class="st">"LOG:LOG"</span><span class="op">)</span>  <span class="co"># The whole column 'LOG'</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span> root         </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> °-- LOG:LOG  ref </span>
<span class="r-in"><span><span class="fu">xlex</span><span class="op">(</span><span class="st">"LOG"</span><span class="op">)</span>      <span class="co"># Not a cell address, must be a named range/formula</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span> root     </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> °-- LOG  name </span>
<span class="r-in"><span><span class="fu">xlex</span><span class="op">(</span><span class="st">"LOG()"</span><span class="op">)</span>    <span class="co"># Another log function</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span> root     </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> ¦-- LOG  function</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> ¦-- (    fun_open</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> °-- )    fun_close </span>
<span class="r-in"><span><span class="fu">xlex</span><span class="op">(</span><span class="st">"A1.2!A1"</span><span class="op">)</span>  <span class="co"># A sheet called 'A1.2'</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span> root       </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> ¦-- A1.2!  sheet</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> °-- A1     ref </span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># Text is surrounded by double-quotes.</span></span></span>
<span class="r-in"><span><span class="fu">xlex</span><span class="op">(</span><span class="st">"\"Some text\""</span><span class="op">)</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span> root             </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> °-- "Some text"  text </span>
<span class="r-in"><span><span class="fu">xlex</span><span class="op">(</span><span class="st">"\"Some \"\"text\"\"\""</span><span class="op">)</span> <span class="co"># Double-quotes within text are escaped by</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span> root                 </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> °-- "Some ""text"""  text </span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># Numbers are signed where it makes sense, and can be scientific</span></span></span>
<span class="r-in"><span><span class="fu">xlex</span><span class="op">(</span><span class="st">"1"</span><span class="op">)</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span> root   </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> °-- 1  number </span>
<span class="r-in"><span><span class="fu">xlex</span><span class="op">(</span><span class="st">"1.2"</span><span class="op">)</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span> root     </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> °-- 1.2  number </span>
<span class="r-in"><span><span class="fu">xlex</span><span class="op">(</span><span class="st">"-1"</span><span class="op">)</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span> root    </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> °-- -1  number </span>
<span class="r-in"><span><span class="fu">xlex</span><span class="op">(</span><span class="st">"-1-1"</span><span class="op">)</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span> root    </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> ¦-- -1  number</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> ¦-- -   operator</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> °-- 1   number </span>
<span class="r-in"><span><span class="fu">xlex</span><span class="op">(</span><span class="st">"-1+-1"</span><span class="op">)</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span> root    </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> ¦-- -1  number</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> ¦-- +   operator</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> °-- -1  number </span>
<span class="r-in"><span><span class="fu">xlex</span><span class="op">(</span><span class="st">"MAX(-1-1)"</span><span class="op">)</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span> root       </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> ¦-- MAX    function</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> °-- (      fun_open</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>     ¦-- -  operator</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>     ¦-- 1  number</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>     ¦-- -  operator</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>     °-- 1  number</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> °-- )      fun_close </span>
<span class="r-in"><span><span class="fu">xlex</span><span class="op">(</span><span class="st">"-1.2E-3"</span><span class="op">)</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span> root         </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> °-- -1.2E-3  number </span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># Booleans can be constants or functions, and names can look like booleans,</span></span></span>
<span class="r-in"><span><span class="co"># but xlex() should always make the right choice.</span></span></span>
<span class="r-in"><span><span class="fu">xlex</span><span class="op">(</span><span class="st">"TRUE"</span><span class="op">)</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span> root      </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> °-- TRUE  bool </span>
<span class="r-in"><span><span class="fu">xlex</span><span class="op">(</span><span class="st">"TRUEISH"</span><span class="op">)</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span> root         </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> °-- TRUEISH  name </span>
<span class="r-in"><span><span class="fu">xlex</span><span class="op">(</span><span class="st">"TRUE!A1"</span><span class="op">)</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span> root       </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> ¦-- TRUE!  sheet</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> °-- A1     ref </span>
<span class="r-in"><span><span class="fu">xlex</span><span class="op">(</span><span class="st">"TRUE()"</span><span class="op">)</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span> root      </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> ¦-- TRUE  function</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> ¦-- (     fun_open</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> °-- )     fun_close </span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># Errors are tagged 'error'</span></span></span>
<span class="r-in"><span><span class="fu">xlex</span><span class="op">(</span><span class="st">"#DIV/0!"</span><span class="op">)</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span> root         </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> °-- #DIV/0!  error </span>
<span class="r-in"><span><span class="fu">xlex</span><span class="op">(</span><span class="st">"#N/A"</span><span class="op">)</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span> root      </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> °-- #N/A  error </span>
<span class="r-in"><span><span class="fu">xlex</span><span class="op">(</span><span class="st">"#NAME?"</span><span class="op">)</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span> root        </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> °-- #NAME?  error </span>
<span class="r-in"><span><span class="fu">xlex</span><span class="op">(</span><span class="st">"#NULL!"</span><span class="op">)</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span> root        </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> °-- #NULL!  error </span>
<span class="r-in"><span><span class="fu">xlex</span><span class="op">(</span><span class="st">"#NUM!"</span><span class="op">)</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span> root       </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> °-- #NUM!  error </span>
<span class="r-in"><span><span class="fu">xlex</span><span class="op">(</span><span class="st">"#REF!"</span><span class="op">)</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span> root       </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> °-- #REF!  error </span>
<span class="r-in"><span><span class="fu">xlex</span><span class="op">(</span><span class="st">"#VALUE!"</span><span class="op">)</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span> root         </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> °-- #VALUE!  error </span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># Operators with more than one character are treated as single tokens</span></span></span>
<span class="r-in"><span><span class="fu">xlex</span><span class="op">(</span><span class="st">"1&lt;&gt;2"</span><span class="op">)</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span> root    </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> ¦-- 1   number</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> ¦-- &lt;&gt;  operator</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> °-- 2   number </span>
<span class="r-in"><span><span class="fu">xlex</span><span class="op">(</span><span class="st">"1&lt;=2"</span><span class="op">)</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span> root    </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> ¦-- 1   number</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> ¦-- &lt;=  operator</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> °-- 2   number </span>
<span class="r-in"><span><span class="fu">xlex</span><span class="op">(</span><span class="st">"1&lt;2"</span><span class="op">)</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span> root   </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> ¦-- 1  number</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> ¦-- &lt;  operator</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> °-- 2  number </span>
<span class="r-in"><span><span class="fu">xlex</span><span class="op">(</span><span class="st">"1=2"</span><span class="op">)</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span> root   </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> ¦-- 1  number</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> ¦-- =  operator</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> °-- 2  number </span>
<span class="r-in"><span><span class="fu">xlex</span><span class="op">(</span><span class="st">"1&amp;2"</span><span class="op">)</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span> root   </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> ¦-- 1  number</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> ¦-- &amp;  operator</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> °-- 2  number </span>
<span class="r-in"><span><span class="fu">xlex</span><span class="op">(</span><span class="st">"1 2"</span><span class="op">)</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span> root   </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> ¦-- 1  number</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> ¦--    operator</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> °-- 2  number </span>
<span class="r-in"><span><span class="fu">xlex</span><span class="op">(</span><span class="st">"(1,2)"</span><span class="op">)</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span> root       </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> °-- (      paren_open</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>     ¦-- 1  number</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>     ¦-- ,  operator</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>     °-- 2  number</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> °-- )      paren_close </span>
<span class="r-in"><span><span class="fu">xlex</span><span class="op">(</span><span class="st">"1%"</span><span class="op">)</span>   <span class="co"># postfix operator</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span> root   </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> ¦-- 1  number</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> °-- %  operator </span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># The union operator is a comma ',', which is the same symbol that is used</span></span></span>
<span class="r-in"><span><span class="co"># to separate function arguments or array columns.  It is tagged 'operator'</span></span></span>
<span class="r-in"><span><span class="co"># only when it is inside parentheses that are not function parentheses or</span></span></span>
<span class="r-in"><span><span class="co"># array curly braces.  The curly braces are tagged 'array_open' and</span></span></span>
<span class="r-in"><span><span class="co"># 'array_close'.</span></span></span>
<span class="r-in"><span><span class="fu">tidyxl</span><span class="fu">::</span><span class="fu">xlex</span><span class="op">(</span><span class="st">"A1,B2"</span><span class="op">)</span> <span class="co"># invalid formula, defaults to 'union' to avoid a crash</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span> root    </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> ¦-- A1  ref</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> ¦-- ,   operator</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> °-- B2  ref </span>
<span class="r-in"><span><span class="fu">tidyxl</span><span class="fu">::</span><span class="fu">xlex</span><span class="op">(</span><span class="st">"(A1,B2)"</span><span class="op">)</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span> root        </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> °-- (       paren_open</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>     ¦-- A1  ref</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>     ¦-- ,   operator</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>     °-- B2  ref</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> °-- )       paren_close </span>
<span class="r-in"><span><span class="fu">tidyxl</span><span class="fu">::</span><span class="fu">xlex</span><span class="op">(</span><span class="st">"MAX(A1,B2)"</span><span class="op">)</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span> root        </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> ¦-- MAX     function</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> °-- (       fun_open</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>     ¦-- A1  ref</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>     ¦-- ,   separator</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>     °-- B2  ref</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> °-- )       fun_close </span>
<span class="r-in"><span><span class="fu">tidyxl</span><span class="fu">::</span><span class="fu">xlex</span><span class="op">(</span><span class="st">"SMALL((A1,B2),1)"</span><span class="op">)</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span> root            </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> ¦-- SMALL       function</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> °-- (           fun_open</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>     °-- (       paren_open</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>         ¦-- A1  ref</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>         ¦-- ,   operator</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>         °-- B2  ref</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>     ¦-- )       paren_close</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>     ¦-- ,       separator</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>     °-- 1       number</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> °-- )           fun_close </span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># Function arguments are separated by commas ',', which are tagged</span></span></span>
<span class="r-in"><span><span class="co"># 'separator'.</span></span></span>
<span class="r-in"><span><span class="fu">xlex</span><span class="op">(</span><span class="st">"MAX(1,2)"</span><span class="op">)</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span> root       </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> ¦-- MAX    function</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> °-- (      fun_open</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>     ¦-- 1  number</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>     ¦-- ,  separator</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>     °-- 2  number</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> °-- )      fun_close </span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># Nested functions are marked by an increase in the 'level'.  The level</span></span></span>
<span class="r-in"><span><span class="co"># increases inside parentheses, rather than at the parentheses.  Curly</span></span></span>
<span class="r-in"><span><span class="co"># braces, for arrays, have the same behaviour, as do subexpressions inside</span></span></span>
<span class="r-in"><span><span class="co"># ordinary parenthesis, tagged 'paren_open' and 'paren_close'.  To see the</span></span></span>
<span class="r-in"><span><span class="co"># levels explicitly (rather than by the pretty printing), print as a normal</span></span></span>
<span class="r-in"><span><span class="co"># data frame or tibble by specifying `pretty = FALSE`.</span></span></span>
<span class="r-in"><span><span class="co"># class with as.data.frame.</span></span></span>
<span class="r-in"><span><span class="fu">xlex</span><span class="op">(</span><span class="st">"MAX(MIN(1,2),3)"</span><span class="op">)</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span> root           </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> ¦-- MAX        function</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> °-- (          fun_open</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>     ¦-- MIN    function</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>     °-- (      fun_open</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>         ¦-- 1  number</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>         ¦-- ,  separator</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>         °-- 2  number</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>     ¦-- )      fun_close</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>     ¦-- ,      separator</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>     °-- 3      number</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> °-- )          fun_close </span>
<span class="r-in"><span><span class="fu">xlex</span><span class="op">(</span><span class="st">"{1,2;3,4}"</span><span class="op">)</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span> root       </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> °-- {      open_array</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>     ¦-- 1  number</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>     ¦-- ,  separator</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>     ¦-- 2  number</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>     ¦-- ;  separator</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>     ¦-- 3  number</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>     ¦-- ,  separator</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>     °-- 4  number</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> °-- }      close_array </span>
<span class="r-in"><span><span class="fu">xlex</span><span class="op">(</span><span class="st">"1*(2+3)"</span><span class="op">)</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span> root       </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> ¦-- 1      number</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> ¦-- *      operator</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> °-- (      paren_open</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>     ¦-- 2  number</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>     ¦-- +  operator</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>     °-- 3  number</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> °-- )      paren_close </span>
<span class="r-in"><span><span class="fu"><a href="https://rdrr.io/r/base/print.html" class="external-link">print</a></span><span class="op">(</span><span class="fu">xlex</span><span class="op">(</span><span class="st">"1*(2+3)"</span><span class="op">)</span>, pretty <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span> <span style="color: #949494;"># A tibble: 7 × 3</span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span>   level type        token</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>   <span style="color: #949494; font-style: italic;">&lt;int&gt;</span> <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>       <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span> <span style="color: #BCBCBC;">1</span>     0 number      1    </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> <span style="color: #BCBCBC;">2</span>     0 operator    *    </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> <span style="color: #BCBCBC;">3</span>     0 paren_open  (    </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> <span style="color: #BCBCBC;">4</span>     1 number      2    </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> <span style="color: #BCBCBC;">5</span>     1 operator    +    </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> <span style="color: #BCBCBC;">6</span>     1 number      3    </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> <span style="color: #BCBCBC;">7</span>     0 paren_close )    </span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># Arrays are marked by opening and closing curly braces, with comma ','</span></span></span>
<span class="r-in"><span><span class="co"># between columns, and semicolons ';' between rows  Commas and semicolons are</span></span></span>
<span class="r-in"><span><span class="co"># both tagged 'separator'.  Arrays contain only constants, which are</span></span></span>
<span class="r-in"><span><span class="co"># booleans, numbers, text, and errors.</span></span></span>
<span class="r-in"><span><span class="fu">xlex</span><span class="op">(</span><span class="st">"MAX({1,2;3,4})"</span><span class="op">)</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span> root           </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> ¦-- MAX        function</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> °-- (          fun_open</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>     °-- {      open_array</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>         ¦-- 1  number</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>         ¦-- ,  separator</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>         ¦-- 2  number</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>         ¦-- ;  separator</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>         ¦-- 3  number</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>         ¦-- ,  separator</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>         °-- 4  number</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>     °-- }      close_array</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> °-- )          fun_close </span>
<span class="r-in"><span><span class="fu">xlex</span><span class="op">(</span><span class="st">"=MAX({-1E-2,TRUE;#N/A,\"Hello, World!\"})"</span><span class="op">)</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span> root                         </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> ¦-- =                        operator</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> ¦-- MAX                      function</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> °-- (                        fun_open</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>     °-- {                    open_array</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>         ¦-- -1E-2            number</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>         ¦-- ,                separator</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>         ¦-- TRUE             bool</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>         ¦-- ;                separator</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>         ¦-- #N/A             error</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>         ¦-- ,                separator</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>         °-- "Hello, World!"  text</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>     °-- }                    close_array</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> °-- )                        fun_close </span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># Structured references are surrounded by square brackets.  Subexpressions</span></span></span>
<span class="r-in"><span><span class="co"># may also be surrounded by square brackets, but xlex() returns the whole</span></span></span>
<span class="r-in"><span><span class="co"># expression in a single 'structured_ref' token.</span></span></span>
<span class="r-in"><span><span class="fu">xlex</span><span class="op">(</span><span class="st">"[@col2]"</span><span class="op">)</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span> root         </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> °-- [@col2]  structured_ref </span>
<span class="r-in"><span><span class="fu">xlex</span><span class="op">(</span><span class="st">"SUM([col22])"</span><span class="op">)</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span> root             </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> ¦-- SUM          function</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> °-- (            fun_open</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>     °-- [col22]  structured_ref</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> °-- )            fun_close </span>
<span class="r-in"><span><span class="fu">xlex</span><span class="op">(</span><span class="st">"Table1[col1]"</span><span class="op">)</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span> root              </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> °-- Table1[col1]  structured_ref </span>
<span class="r-in"><span><span class="fu">xlex</span><span class="op">(</span><span class="st">"Table1[[col1]:[col2]]"</span><span class="op">)</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span> root                       </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> °-- Table1[[col1]:[col2]]  structured_ref </span>
<span class="r-in"><span><span class="fu">xlex</span><span class="op">(</span><span class="st">"Table1[#Headers]"</span><span class="op">)</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span> root                  </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> °-- Table1[#Headers]  structured_ref </span>
<span class="r-in"><span><span class="fu">xlex</span><span class="op">(</span><span class="st">"Table1[[#Headers],[col1]]"</span><span class="op">)</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span> root                           </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> °-- Table1[[#Headers],[col1]]  structured_ref </span>
<span class="r-in"><span><span class="fu">xlex</span><span class="op">(</span><span class="st">"Table1[[#Headers],[col1]:[col2]]"</span><span class="op">)</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span> root                                  </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> °-- Table1[[#Headers],[col1]:[col2]]  structured_ref </span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># DDE calls (Dynamic Data Exchange) are normalized by Excel into indexes.</span></span></span>
<span class="r-in"><span><span class="co"># Either way, xlex() includes everything in one token.</span></span></span>
<span class="r-in"><span><span class="fu">xlex</span><span class="op">(</span><span class="st">"[1]!'DDE_parameter=1'"</span><span class="op">)</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span> root                       </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> °-- [1]!'DDE_parameter=1'  DDE </span>
<span class="r-in"><span><span class="fu">xlex</span><span class="op">(</span><span class="st">"'Quote'|'NYSE'!ZAXX"</span><span class="op">)</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span> root                     </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> °-- 'Quote'|'NYSE'!ZAXX  DDE </span>
<span class="r-in"><span><span class="co"># Meaningless spaces that appear in some old files are returned as 'space'</span></span></span>
<span class="r-in"><span><span class="co"># tokens, so that the original formula can still be recovered by</span></span></span>
<span class="r-in"><span><span class="co"># concatenating all the tokens.  Spaces between function names and their open</span></span></span>
<span class="r-in"><span><span class="co"># parenthesis have not been observed, so are not permitted.</span></span></span>
<span class="r-in"><span><span class="fu">xlex</span><span class="op">(</span><span class="st">" MAX( A1 ) "</span><span class="op">)</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span> root        </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> ¦--         operator</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> ¦-- MAX     function</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> °-- (       fun_open</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>     ¦--     operator</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>     ¦-- A1  ref</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>     °--     operator</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> ¦-- )       fun_close</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> °--         operator </span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># print.xlex() invisibly returns the original argument, so that it can be</span></span></span>
<span class="r-in"><span><span class="co"># used in magrittr pipelines.</span></span></span>
<span class="r-in"><span><span class="fu"><a href="https://rdrr.io/r/utils/str.html" class="external-link">str</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/print.html" class="external-link">print</a></span><span class="op">(</span><span class="fu">xlex</span><span class="op">(</span><span class="st">"ROUND(A1*2"</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span> root        </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> ¦-- ROUND   function</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> °-- (       fun_open</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>     ¦-- A1  ref</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>     ¦-- *   operator</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>     °-- 2   number </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> xlex [5 × 3] (S3: xlex/tbl_df/tbl/data.frame)</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>  $ level: int [1:5] 0 0 1 1 1</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>  $ type : chr [1:5] "function" "fun_open" "ref" "operator" ...</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>  $ token: chr [1:5] "ROUND" "(" "A1" "*" ...</span>
</code></pre></div>
    </div>
  </main><aside class="col-md-3"><nav id="toc"><h2>On this page</h2>
    </nav></aside></div>


    <footer><div class="pkgdown-footer-left">
  <p></p><p>Developed by Duncan Garmonsway.</p>
</div>

<div class="pkgdown-footer-right">
  <p></p><p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.0.6.</p>
</div>

    </footer></div>

  

  

  </body></html>

