<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<meta name="description" content="tidyxl">
<title>Tidyxl • tidyxl</title>
<script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="../deps/bootstrap-5.2.2/bootstrap.min.css" rel="stylesheet">
<script src="../deps/bootstrap-5.2.2/bootstrap.bundle.min.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- bootstrap-toc --><script src="https://cdn.jsdelivr.net/gh/afeld/bootstrap-toc@v1.0.1/dist/bootstrap-toc.min.js" integrity="sha256-4veVQbu7//Lk5TSmc7YV48MxtMy98e26cf5MrgZYnwo=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- search --><script src="https://cdnjs.cloudflare.com/ajax/libs/fuse.js/6.4.6/fuse.js" integrity="sha512-zv6Ywkjyktsohkbp9bb45V6tEMoWhzFzXis+LrMehmJZZSys19Yxf1dopHx7WzIKxr5tK2dVcYmaCk2uqdjF4A==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/autocomplete.js/0.38.0/autocomplete.jquery.min.js" integrity="sha512-GU9ayf+66Xx2TmpxqJpliWbT5PiGYxpaG8rfnBEk1LL8l1KGkRShhngwdXK1UgqhAzWpZHSiYPc09/NwDQIGyg==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mark.js/8.11.1/mark.min.js" integrity="sha512-5CYOlHXGh6QpOFA/TeTylKLWfB3ftPsde7AnmhuitiTX4K5SqCLBeKro6sPS8ilsz1Q4NRx3v8Ko2IBiszzdww==" crossorigin="anonymous"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="Tidyxl">
<meta property="og:description" content="tidyxl">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>
    

    <nav class="navbar fixed-top navbar-light navbar-expand-lg bg-light"><div class="container">
    
    <a class="navbar-brand me-2" href="../index.html">tidyxl</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">1.0.8</small>

    
    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto">
<li class="active nav-item">
  <a class="nav-link" href="../articles/tidyxl.html">Get started</a>
</li>
<li class="nav-item">
  <a class="nav-link" href="../reference/index.html">Reference</a>
</li>
<li class="nav-item dropdown">
  <a href="#" class="nav-link dropdown-toggle" data-bs-toggle="dropdown" role="button" aria-expanded="false" aria-haspopup="true" id="dropdown-articles">Articles</a>
  <div class="dropdown-menu" aria-labelledby="dropdown-articles">
    <a class="dropdown-item" href="../articles/data-validation-rules.html">Data Validation Rules</a>
    <a class="dropdown-item" href="../articles/smells.html">Detecting Spreadsheet Smells with xlex()</a>
  </div>
</li>
<li class="nav-item">
  <a class="nav-link" href="../news/index.html">Changelog</a>
</li>
      </ul>
<form class="form-inline my-2 my-lg-0" role="search">
        <input type="search" class="form-control me-sm-2" aria-label="Toggle navigation" name="search-input" data-search-index="../search.json" id="search-input" placeholder="Search for" autocomplete="off">
</form>

      <ul class="navbar-nav">
<li class="nav-item">
  <a class="external-link nav-link" href="https://github.com/nacnudus/tidyxl/" aria-label="github">
    <span class="fab fa fab fa-github fa-lg"></span>
     
  </a>
</li>
      </ul>
</div>

    
  </div>
</nav><div class="container template-article">




<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">
      <img src="" class="logo" alt=""><h1>Tidyxl</h1>
                        <h4 data-toc-skip class="author">Duncan
Garmonsway</h4>
            
            <h4 data-toc-skip class="date">2023-04-12</h4>
      
      <small class="dont-index">Source: <a href="https://github.com/nacnudus/tidyxl/blob/HEAD/vignettes/tidyxl.Rmd" class="external-link"><code>vignettes/tidyxl.Rmd</code></a></small>
      <div class="d-none name"><code>tidyxl.Rmd</code></div>
    </div>

    
    
<style>
pre code, pre, code {
  white-space: pre !important;
  overflow-x: scroll !important;
  word-break: keep-all !important;
  word-wrap: initial !important;
}
</style>
<div class="section level2">
<h2 id="tidyxl">tidyxl<a class="anchor" aria-label="anchor" href="#tidyxl"></a>
</h2>
<p><a href="https://github.com/nacnudus/tidyxl" class="external-link">tidyxl</a> imports
non-tabular data from Excel files into R. It exposes cell content,
position, formatting and comments in a tidy structure for further
manipulation, especially by the <a href="https://github.com/nacnudus/unpivotr" class="external-link">unpivotr</a> package. It
supports the xml-based file formats ‘.xlsx’ and ‘.xlsm’ via the embedded
<a href="http://rapidxml.sourceforge.net" class="external-link">RapidXML</a> C++ library. It
does not support the binary file formats ‘.xlsb’ or ‘.xls’.</p>
<p>It also provides a function <code><a href="../reference/xlex.html">xlex()</a></code> for tokenizing
formulas. See the <a href="https://nacnudus.github.io/tidyxl/articles/smells.html">vignette</a>
for details. It is useful for detecting ‘spreadsheet smells’ (poor
practice such as embedding constants in formulas, or using deep levels
of nesting), and for understanding the dependency structures within
spreadsheets.</p>
<div class="section level3">
<h3 id="mailing-list">Mailing list<a class="anchor" aria-label="anchor" href="#mailing-list"></a>
</h3>
<p>For bugs and/or issues, create a new issue on <a href="https://github.com/nacnudus/tidyxl/issues" class="external-link">GitHub</a> For other
questions or comments, please subscribe to the <a href="https://groups.google.com/forum/#!forum/tidyxl-devel" class="external-link">tidyxl-devel
mailing list</a>. You must be a member to post messages, but anyone can
read the archived discussions.</p>
</div>
<div class="section level3">
<h3 id="installation">Installation<a class="anchor" aria-label="anchor" href="#installation"></a>
</h3>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">devtools</span><span class="fu">::</span><span class="fu">install_github</span><span class="op">(</span><span class="st">"nacnudus/tidyxl"</span><span class="op">)</span></span></code></pre></div>
</div>
<div class="section level3">
<h3 id="examples">Examples<a class="anchor" aria-label="anchor" href="#examples"></a>
</h3>
<p>The package includes a spreadsheet, ‘titanic.xlsx’, which contains
the following pivot table:</p>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/stats/ftable.html" class="external-link">ftable</a></span><span class="op">(</span><span class="va">Titanic</span>, row.vars <span class="op">=</span> <span class="fl">1</span><span class="op">:</span><span class="fl">2</span><span class="op">)</span></span>
<span><span class="co">#&gt;              Age      Child     Adult    </span></span>
<span><span class="co">#&gt;              Survived    No Yes    No Yes</span></span>
<span><span class="co">#&gt; Class Sex                                </span></span>
<span><span class="co">#&gt; 1st   Male                0   5   118  57</span></span>
<span><span class="co">#&gt;       Female              0   1     4 140</span></span>
<span><span class="co">#&gt; 2nd   Male                0  11   154  14</span></span>
<span><span class="co">#&gt;       Female              0  13    13  80</span></span>
<span><span class="co">#&gt; 3rd   Male               35  13   387  75</span></span>
<span><span class="co">#&gt;       Female             17  14    89  76</span></span>
<span><span class="co">#&gt; Crew  Male                0   0   670 192</span></span>
<span><span class="co">#&gt;       Female              0   0     3  20</span></span></code></pre></div>
<p>The multi-row column headers make this difficult to import. A popular
package for importing spreadsheets coerces the pivot table into a
dataframe. It treats the second header row as though it were
observations.</p>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">titanic</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/system.file.html" class="external-link">system.file</a></span><span class="op">(</span><span class="st">"extdata/titanic.xlsx"</span>, package <span class="op">=</span> <span class="st">"tidyxl"</span><span class="op">)</span></span>
<span><span class="fu">readxl</span><span class="fu">::</span><span class="fu"><a href="https://readxl.tidyverse.org/reference/read_excel.html" class="external-link">read_excel</a></span><span class="op">(</span><span class="va">titanic</span><span class="op">)</span></span>
<span><span class="co">#&gt; New names:</span></span>
<span><span class="co">#&gt; <span style="color: #00BBBB;">•</span> `` -&gt; `...1`</span></span>
<span><span class="co">#&gt; <span style="color: #00BBBB;">•</span> `` -&gt; `...2`</span></span>
<span><span class="co">#&gt; <span style="color: #00BBBB;">•</span> `` -&gt; `...5`</span></span>
<span><span class="co">#&gt; <span style="color: #00BBBB;">•</span> `` -&gt; `...7`</span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># A tibble: 10 × 7</span></span></span>
<span><span class="co">#&gt;    ...1  ...2   Age      Child ...5  Adult ...7 </span></span>
<span><span class="co">#&gt;    <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span> <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>  <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>    <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span> <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span> <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span> <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span></span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 1</span> <span style="color: #BB0000;">NA</span>    <span style="color: #BB0000;">NA</span>     Survived No    Yes   No    Yes  </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 2</span> Class Sex    <span style="color: #BB0000;">NA</span>       <span style="color: #BB0000;">NA</span>    <span style="color: #BB0000;">NA</span>    <span style="color: #BB0000;">NA</span>    <span style="color: #BB0000;">NA</span>   </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 3</span> 1st   Male   <span style="color: #BB0000;">NA</span>       0     5     118   57   </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 4</span> <span style="color: #BB0000;">NA</span>    Female <span style="color: #BB0000;">NA</span>       0     1     4     140  </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 5</span> 2nd   Male   <span style="color: #BB0000;">NA</span>       0     11    154   14   </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 6</span> <span style="color: #BB0000;">NA</span>    Female <span style="color: #BB0000;">NA</span>       0     13    13    80   </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 7</span> 3rd   Male   <span style="color: #BB0000;">NA</span>       35    13    387   75   </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 8</span> <span style="color: #BB0000;">NA</span>    Female <span style="color: #BB0000;">NA</span>       17    14    89    76   </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 9</span> Crew  Male   <span style="color: #BB0000;">NA</span>       0     0     670   192  </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">10</span> <span style="color: #BB0000;">NA</span>    Female <span style="color: #BB0000;">NA</span>       0     0     3     20</span></span></code></pre></div>
<p><a href="https://github.com/nacnudus/tidyxl" class="external-link">tidyxl</a> doesn’t
coerce the pivot table into a data frame. Instead, it represents each
cell in its own row, where it describes the cell’s address, value and
other properties.</p>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/nacnudus/tidyxl" class="external-link">tidyxl</a></span><span class="op">)</span></span>
<span><span class="va">x</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/xlsx_cells.html">xlsx_cells</a></span><span class="op">(</span><span class="va">titanic</span><span class="op">)</span></span>
<span><span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://pillar.r-lib.org/reference/glimpse.html" class="external-link">glimpse</a></span><span class="op">(</span><span class="va">x</span><span class="op">)</span></span>
<span><span class="co">#&gt; Rows: 60</span></span>
<span><span class="co">#&gt; Columns: 24</span></span>
<span><span class="co">#&gt; $ sheet               <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span> "Sheet1", "Sheet1", "Sheet1", "Sheet1", "Sheet1", …</span></span>
<span><span class="co">#&gt; $ address             <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span> "C1", "D1", "E1", "F1", "G1", "C2", "D2", "E2", "F…</span></span>
<span><span class="co">#&gt; $ row                 <span style="color: #949494; font-style: italic;">&lt;int&gt;</span> 1, 1, 1, 1, 1, 2, 2, 2, 2, 2, 3, 3, 4, 4, 4, 4, 4,…</span></span>
<span><span class="co">#&gt; $ col                 <span style="color: #949494; font-style: italic;">&lt;int&gt;</span> 3, 4, 5, 6, 7, 3, 4, 5, 6, 7, 1, 2, 1, 2, 4, 5, 6,…</span></span>
<span><span class="co">#&gt; $ is_blank            <span style="color: #949494; font-style: italic;">&lt;lgl&gt;</span> FALSE, FALSE, TRUE, FALSE, TRUE, FALSE, FALSE, FAL…</span></span>
<span><span class="co">#&gt; $ content             <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span> "0", "1", NA, "2", NA, "3", "4", "5", "4", "5", "6…</span></span>
<span><span class="co">#&gt; $ data_type           <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span> "character", "character", "blank", "character", "b…</span></span>
<span><span class="co">#&gt; $ error               <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span> NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA…</span></span>
<span><span class="co">#&gt; $ logical             <span style="color: #949494; font-style: italic;">&lt;lgl&gt;</span> NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA…</span></span>
<span><span class="co">#&gt; $ numeric             <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span> NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA…</span></span>
<span><span class="co">#&gt; $ date                <span style="color: #949494; font-style: italic;">&lt;dttm&gt;</span> NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, N…</span></span>
<span><span class="co">#&gt; $ character           <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span> "Age", "Child", NA, "Adult", NA, "Survived", "No",…</span></span>
<span><span class="co">#&gt; $ character_formatted <span style="color: #949494; font-style: italic;">&lt;list&gt;</span> [&lt;tbl_df[1 x 14]&gt;], [&lt;tbl_df[1 x 14]&gt;], &lt;NULL&gt;, […</span></span>
<span><span class="co">#&gt; $ formula             <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span> NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA…</span></span>
<span><span class="co">#&gt; $ is_array            <span style="color: #949494; font-style: italic;">&lt;lgl&gt;</span> FALSE, FALSE, FALSE, FALSE, FALSE, FALSE, FALSE, F…</span></span>
<span><span class="co">#&gt; $ formula_ref         <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span> NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA…</span></span>
<span><span class="co">#&gt; $ formula_group       <span style="color: #949494; font-style: italic;">&lt;int&gt;</span> NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA…</span></span>
<span><span class="co">#&gt; $ comment             <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span> NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA…</span></span>
<span><span class="co">#&gt; $ height              <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span> 15, 15, 15, 15, 15, 15, 15, 15, 15, 15, 15, 15, 15…</span></span>
<span><span class="co">#&gt; $ width               <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span> 8.38, 8.38, 8.38, 8.38, 8.38, 8.38, 8.38, 8.38, 8.…</span></span>
<span><span class="co">#&gt; $ row_outline_level   <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span> 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1,…</span></span>
<span><span class="co">#&gt; $ col_outline_level   <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span> 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1,…</span></span>
<span><span class="co">#&gt; $ style_format        <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span> "Normal", "Normal", "Normal", "Normal", "Normal", …</span></span>
<span><span class="co">#&gt; $ local_format_id     <span style="color: #949494; font-style: italic;">&lt;int&gt;</span> 2, 3, 3, 3, 3, 2, 3, 3, 3, 3, 2, 2, 3, 3, 1, 1, 1,…</span></span></code></pre></div>
<p>In this structure, the cells can be found by filtering.</p>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">x</span><span class="op">[</span><span class="va">x</span><span class="op">$</span><span class="va">data_type</span> <span class="op">==</span> <span class="st">"character"</span>, <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"address"</span>, <span class="st">"character"</span><span class="op">)</span><span class="op">]</span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># A tibble: 22 × 2</span></span></span>
<span><span class="co">#&gt;    address character</span></span>
<span><span class="co">#&gt;    <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>   <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>    </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 1</span> C1      Age      </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 2</span> D1      Child    </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 3</span> F1      Adult    </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 4</span> C2      Survived </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 5</span> D2      No       </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 6</span> E2      Yes      </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 7</span> F2      No       </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 8</span> G2      Yes      </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 9</span> A3      Class    </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">10</span> B3      Sex      </span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># ℹ 12 more rows</span></span></span>
<span><span class="va">x</span><span class="op">[</span><span class="va">x</span><span class="op">$</span><span class="va">row</span> <span class="op">==</span> <span class="fl">4</span>, <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"address"</span>, <span class="st">"character"</span>, <span class="st">"numeric"</span><span class="op">)</span><span class="op">]</span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># A tibble: 6 × 3</span></span></span>
<span><span class="co">#&gt;   address character numeric</span></span>
<span><span class="co">#&gt;   <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>   <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>       <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span></span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">1</span> A4      1st            <span style="color: #BB0000;">NA</span></span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">2</span> B4      Male           <span style="color: #BB0000;">NA</span></span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">3</span> D4      <span style="color: #BB0000;">NA</span>              0</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">4</span> E4      <span style="color: #BB0000;">NA</span>              5</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">5</span> F4      <span style="color: #BB0000;">NA</span>            118</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">6</span> G4      <span style="color: #BB0000;">NA</span>             57</span></span></code></pre></div>
<p>Specific sheets can be requested using
<code>xlsx_cells(file, sheet)</code>, and the names of all sheets in a
file are given by <code><a href="../reference/xlsx_sheet_names.html">xlsx_sheet_names()</a></code>.</p>
<div class="section level4">
<h4 id="formatting">Formatting<a class="anchor" aria-label="anchor" href="#formatting"></a>
</h4>
<p>The original spreadsheet has formatting applied to the cells. This
can also be retrieved using <a href="https://github.com/nacnudus/tidyxl" class="external-link">tidyxl</a>, with the
<code><a href="../reference/xlsx_formats.html">xlsx_formats()</a></code> function.</p>
<p><img src="titanic-screenshot.png" alt="Screenshot of a spreadsheet with meaningful formatting"></p>
<p>Formatting is available by using the columns
<code>local_format_id</code> and <code>style_format</code> as indexes
into a separate list-of-lists structure. ‘Local’ formatting is the most
common kind, applied to individual cells. ‘Style’ formatting is usually
applied to blocks of cells, and defines several formats at once. Here is
a screenshot of the styles buttons in Excel.</p>
<p><img src="styles-screenshot.png" alt="Screenshot of a formatting options available in Excel"></p>
<p>Formatting can be looked up as follows.</p>
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Bold</span></span>
<span><span class="va">formats</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/xlsx_formats.html">xlsx_formats</a></span><span class="op">(</span><span class="va">titanic</span><span class="op">)</span></span>
<span><span class="va">formats</span><span class="op">$</span><span class="va">local</span><span class="op">$</span><span class="va">font</span><span class="op">$</span><span class="va">bold</span></span>
<span><span class="co">#&gt; [1] FALSE  TRUE FALSE FALSE</span></span>
<span><span class="va">x</span><span class="op">[</span><span class="va">x</span><span class="op">$</span><span class="va">local_format_id</span> <span class="op"><a href="https://rdrr.io/r/base/match.html" class="external-link">%in%</a></span> <span class="fu"><a href="https://rdrr.io/r/base/which.html" class="external-link">which</a></span><span class="op">(</span><span class="va">formats</span><span class="op">$</span><span class="va">local</span><span class="op">$</span><span class="va">font</span><span class="op">$</span><span class="va">bold</span><span class="op">)</span>,</span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"address"</span>, <span class="st">"character"</span><span class="op">)</span><span class="op">]</span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># A tibble: 4 × 2</span></span></span>
<span><span class="co">#&gt;   address character</span></span>
<span><span class="co">#&gt;   <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>   <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>    </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">1</span> C1      Age      </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">2</span> C2      Survived </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">3</span> A3      Class    </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">4</span> B3      Sex</span></span>
<span></span>
<span><span class="co"># Yellow fill</span></span>
<span><span class="va">formats</span><span class="op">$</span><span class="va">local</span><span class="op">$</span><span class="va">fill</span><span class="op">$</span><span class="va">patternFill</span><span class="op">$</span><span class="va">fgColor</span><span class="op">$</span><span class="va">rgb</span></span>
<span><span class="co">#&gt; [1] NA         NA         NA         "FFFFFF00"</span></span>
<span><span class="va">x</span><span class="op">[</span><span class="va">x</span><span class="op">$</span><span class="va">local_format_id</span> <span class="op"><a href="https://rdrr.io/r/base/match.html" class="external-link">%in%</a></span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/which.html" class="external-link">which</a></span><span class="op">(</span><span class="va">formats</span><span class="op">$</span><span class="va">local</span><span class="op">$</span><span class="va">fill</span><span class="op">$</span><span class="va">patternFill</span><span class="op">$</span><span class="va">fgColor</span><span class="op">$</span><span class="va">rgb</span> <span class="op">==</span> <span class="st">"FFFFFF00"</span><span class="op">)</span>,</span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"address"</span>, <span class="st">"numeric"</span><span class="op">)</span><span class="op">]</span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># A tibble: 2 × 2</span></span></span>
<span><span class="co">#&gt;   address numeric</span></span>
<span><span class="co">#&gt;   <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>     <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span></span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">1</span> F11           3</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">2</span> G11          20</span></span>
<span></span>
<span><span class="co"># Styles by name</span></span>
<span><span class="va">formats</span><span class="op">$</span><span class="va">style</span><span class="op">$</span><span class="va">font</span><span class="op">$</span><span class="va">name</span><span class="op">[</span><span class="st">"Normal"</span><span class="op">]</span></span>
<span><span class="co">#&gt;    Normal </span></span>
<span><span class="co">#&gt; "Calibri"</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span><span class="va">x</span><span class="op">[</span><span class="va">x</span><span class="op">$</span><span class="va">style_format</span> <span class="op">==</span> <span class="st">"Normal"</span>, <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"address"</span>, <span class="st">"character"</span><span class="op">)</span><span class="op">]</span><span class="op">)</span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># A tibble: 6 × 2</span></span></span>
<span><span class="co">#&gt;   address character</span></span>
<span><span class="co">#&gt;   <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>   <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>    </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">1</span> C1      Age      </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">2</span> D1      Child    </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">3</span> E1      <span style="color: #BB0000;">NA</span>       </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">4</span> F1      Adult    </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">5</span> G1      <span style="color: #BB0000;">NA</span>       </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">6</span> C2      Survived</span></span>
<span></span>
<span><span class="co"># In-cell formatting is available in the `character_formatted` column as a data</span></span>
<span><span class="co"># frame, one row per substring.</span></span>
<span><span class="va">examples</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/system.file.html" class="external-link">system.file</a></span><span class="op">(</span><span class="st">"/extdata/examples.xlsx"</span>, package <span class="op">=</span> <span class="st">"tidyxl"</span><span class="op">)</span></span>
<span><span class="fu"><a href="../reference/xlsx_cells.html">xlsx_cells</a></span><span class="op">(</span><span class="va">examples</span><span class="op">)</span><span class="op">$</span><span class="va">character_formatted</span><span class="op">[</span><span class="fl">77</span><span class="op">]</span></span>
<span><span class="co">#&gt; [[1]]</span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># A tibble: 16 × 14</span></span></span>
<span><span class="co">#&gt;    character bold  italic underline strike vertAlign  size color_rgb color_theme</span></span>
<span><span class="co">#&gt;    <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>     <span style="color: #949494; font-style: italic;">&lt;lgl&gt;</span> <span style="color: #949494; font-style: italic;">&lt;lgl&gt;</span>  <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>     <span style="color: #949494; font-style: italic;">&lt;lgl&gt;</span>  <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>     <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span> <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>           <span style="color: #949494; font-style: italic;">&lt;int&gt;</span></span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 1</span> <span style="color: #949494;">"</span>in-cell<span style="color: #949494;">"</span> FALSE FALSE  <span style="color: #BB0000;">NA</span>        FALSE  <span style="color: #BB0000;">NA</span>            0 <span style="color: #BB0000;">NA</span>                 <span style="color: #BB0000;">NA</span></span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 2</span> <span style="color: #949494;">"</span>bold<span style="color: #949494;">"</span>    TRUE  FALSE  <span style="color: #BB0000;">NA</span>        FALSE  <span style="color: #BB0000;">NA</span>            0 FF000000            2</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 3</span> <span style="color: #949494;">"</span>italic<span style="color: #949494;">"</span>  FALSE TRUE   <span style="color: #BB0000;">NA</span>        FALSE  <span style="color: #BB0000;">NA</span>            0 FF000000            2</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 4</span> <span style="color: #949494;">"</span>underli… FALSE FALSE  single    FALSE  <span style="color: #BB0000;">NA</span>            0 FF000000            2</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 5</span> <span style="color: #949494;">"</span>underli… FALSE FALSE  double    FALSE  <span style="color: #BB0000;">NA</span>            0 FF000000            2</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 6</span> <span style="color: #949494;">"</span>singlea… FALSE FALSE  singleAc… FALSE  <span style="color: #BB0000;">NA</span>            0 FF000000            2</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 7</span> <span style="color: #949494;">"</span>doublea… FALSE FALSE  doubleAc… FALSE  <span style="color: #BB0000;">NA</span>            0 FF000000            2</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 8</span> <span style="color: #949494;">"</span>striket… FALSE FALSE  <span style="color: #BB0000;">NA</span>        TRUE   <span style="color: #BB0000;">NA</span>            0 FF000000            2</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 9</span> <span style="color: #949494;">"</span>subscri… FALSE FALSE  <span style="color: #BB0000;">NA</span>        FALSE  subscript     0 FF000000            2</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">10</span> <span style="color: #949494;">"</span>supersc… FALSE FALSE  <span style="color: #BB0000;">NA</span>        FALSE  superscr…     0 FF000000            2</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">11</span> <span style="color: #949494;">"</span>red<span style="color: #949494;">"</span>     FALSE FALSE  <span style="color: #BB0000;">NA</span>        FALSE  <span style="color: #BB0000;">NA</span>            0 FFFF0000           <span style="color: #BB0000;">NA</span></span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">12</span> <span style="color: #949494;">"</span>theme<span style="color: #949494;">"</span>   FALSE FALSE  <span style="color: #BB0000;">NA</span>        FALSE  <span style="color: #BB0000;">NA</span>            0 FFC0504D            6</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">13</span> <span style="color: #949494;">"</span>tint<span style="color: #949494;">"</span>    FALSE FALSE  <span style="color: #BB0000;">NA</span>        FALSE  <span style="color: #BB0000;">NA</span>            0 FFC0504D            6</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">14</span> <span style="color: #949494;">"</span>size<span style="color: #949494;">"</span>    FALSE FALSE  <span style="color: #BB0000;">NA</span>        FALSE  <span style="color: #BB0000;">NA</span>            0 FFFF0000           <span style="color: #BB0000;">NA</span></span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">15</span> <span style="color: #949494;">"</span>arial<span style="color: #949494;">"</span>   FALSE FALSE  <span style="color: #BB0000;">NA</span>        FALSE  <span style="color: #BB0000;">NA</span>            0 FFFF0000           <span style="color: #BB0000;">NA</span></span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">16</span> <span style="color: #949494;">"</span>UTF8Sté… FALSE FALSE  <span style="color: #BB0000;">NA</span>        FALSE  <span style="color: #BB0000;">NA</span>            0 FFFF0000           <span style="color: #BB0000;">NA</span></span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># ℹ 5 more variables: color_indexed &lt;int&gt;, color_tint &lt;dbl&gt;, font &lt;chr&gt;,</span></span></span>
<span><span class="co">#&gt; <span style="color: #949494;">#   family &lt;int&gt;, scheme &lt;chr&gt;</span></span></span></code></pre></div>
<p>To see all the available kinds of formats, use
<code>str(formats)</code>.</p>
</div>
<div class="section level4">
<h4 id="comments">Comments<a class="anchor" aria-label="anchor" href="#comments"></a>
</h4>
<p>Comments are available alongside cell values.</p>
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">x</span><span class="op">[</span><span class="op">!</span><span class="fu"><a href="https://rdrr.io/r/base/NA.html" class="external-link">is.na</a></span><span class="op">(</span><span class="va">x</span><span class="op">$</span><span class="va">comment</span><span class="op">)</span>, <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"address"</span>, <span class="st">"comment"</span><span class="op">)</span><span class="op">]</span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># A tibble: 1 × 2</span></span></span>
<span><span class="co">#&gt;   address comment                                                    </span></span>
<span><span class="co">#&gt;   <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>   <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>                                                      </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">1</span> G11     All women in the crew worked in the victualling department.</span></span></code></pre></div>
</div>
<div class="section level4">
<h4 id="formulas">Formulas<a class="anchor" aria-label="anchor" href="#formulas"></a>
</h4>
<p>Formulas are available, but with a few quirks.</p>
<div class="sourceCode" id="cb8"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/options.html" class="external-link">options</a></span><span class="op">(</span>width <span class="op">=</span> <span class="fl">120</span><span class="op">)</span></span>
<span><span class="va">y</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/xlsx_cells.html">xlsx_cells</a></span><span class="op">(</span><span class="va">examples</span>, <span class="st">"Sheet1"</span><span class="op">)</span></span>
<span><span class="va">y</span><span class="op">[</span><span class="op">!</span><span class="fu"><a href="https://rdrr.io/r/base/NA.html" class="external-link">is.na</a></span><span class="op">(</span><span class="va">y</span><span class="op">$</span><span class="va">formula</span><span class="op">)</span>,</span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"address"</span>, <span class="st">"formula"</span>, <span class="st">"is_array"</span>, <span class="st">"formula_ref"</span>, <span class="st">"formula_group"</span>,</span>
<span>    <span class="st">"error"</span>, <span class="st">"logical"</span>, <span class="st">"numeric"</span>, <span class="st">"date"</span>, <span class="st">"character"</span><span class="op">)</span><span class="op">]</span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># A tibble: 32 × 10</span></span></span>
<span><span class="co">#&gt;    address formula             is_array formula_ref formula_group error   logical numeric date                character </span></span>
<span><span class="co">#&gt;    <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>   <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>               <span style="color: #949494; font-style: italic;">&lt;lgl&gt;</span>    <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>               <span style="color: #949494; font-style: italic;">&lt;int&gt;</span> <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>   <span style="color: #949494; font-style: italic;">&lt;lgl&gt;</span>     <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span> <span style="color: #949494; font-style: italic;">&lt;dttm&gt;</span>              <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>     </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 1</span> A1      <span style="color: #949494;">"</span>1/0<span style="color: #949494;">"</span>               FALSE    <span style="color: #BB0000;">NA</span>                     <span style="color: #BB0000;">NA</span> #DIV/0! <span style="color: #BB0000;">NA</span>           <span style="color: #BB0000;">NA</span> <span style="color: #BB0000;">NA</span>                  <span style="color: #BB0000;">NA</span>        </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 2</span> A14     <span style="color: #949494;">"</span>1=1<span style="color: #949494;">"</span>               FALSE    <span style="color: #BB0000;">NA</span>                     <span style="color: #BB0000;">NA</span> <span style="color: #BB0000;">NA</span>      TRUE         <span style="color: #BB0000;">NA</span> <span style="color: #BB0000;">NA</span>                  <span style="color: #BB0000;">NA</span>        </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 3</span> A15     <span style="color: #949494;">"</span>A4+1<span style="color: #949494;">"</span>              FALSE    <span style="color: #BB0000;">NA</span>                     <span style="color: #BB0000;">NA</span> <span style="color: #BB0000;">NA</span>      <span style="color: #BB0000;">NA</span>         <span style="text-decoration: underline;">1</span>338 <span style="color: #BB0000;">NA</span>                  <span style="color: #BB0000;">NA</span>        </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 4</span> A16     <span style="color: #949494;">"</span>DATE(2017,1,18)<span style="color: #949494;">"</span>   FALSE    <span style="color: #BB0000;">NA</span>                     <span style="color: #BB0000;">NA</span> <span style="color: #BB0000;">NA</span>      <span style="color: #BB0000;">NA</span>           <span style="color: #BB0000;">NA</span> 2017-01-18 <span style="color: #949494;">00:00:00</span> <span style="color: #BB0000;">NA</span>        </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 5</span> A17     <span style="color: #949494;">"</span>\"Hello, World!\"<span style="color: #949494;">"</span> FALSE    <span style="color: #BB0000;">NA</span>                     <span style="color: #BB0000;">NA</span> <span style="color: #BB0000;">NA</span>      <span style="color: #BB0000;">NA</span>           <span style="color: #BB0000;">NA</span> <span style="color: #BB0000;">NA</span>                  Hello, Wo…</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 6</span> A19     <span style="color: #949494;">"</span>$A$18+1<span style="color: #949494;">"</span>           FALSE    <span style="color: #BB0000;">NA</span>                     <span style="color: #BB0000;">NA</span> <span style="color: #BB0000;">NA</span>      <span style="color: #BB0000;">NA</span>            2 <span style="color: #BB0000;">NA</span>                  <span style="color: #BB0000;">NA</span>        </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 7</span> B19     <span style="color: #949494;">"</span>A18+2<span style="color: #949494;">"</span>             FALSE    <span style="color: #BB0000;">NA</span>                     <span style="color: #BB0000;">NA</span> <span style="color: #BB0000;">NA</span>      <span style="color: #BB0000;">NA</span>            3 <span style="color: #BB0000;">NA</span>                  <span style="color: #BB0000;">NA</span>        </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 8</span> A20     <span style="color: #949494;">"</span>$A$18+1<span style="color: #949494;">"</span>           FALSE    A20:A21                 0 <span style="color: #BB0000;">NA</span>      <span style="color: #BB0000;">NA</span>            2 <span style="color: #BB0000;">NA</span>                  <span style="color: #BB0000;">NA</span>        </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 9</span> B20     <span style="color: #949494;">"</span>A19+2<span style="color: #949494;">"</span>             FALSE    B20:B21                 1 <span style="color: #BB0000;">NA</span>      <span style="color: #BB0000;">NA</span>            4 <span style="color: #BB0000;">NA</span>                  <span style="color: #BB0000;">NA</span>        </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">10</span> A21     <span style="color: #949494;">"</span>$A$18+1<span style="color: #949494;">"</span>           FALSE    <span style="color: #BB0000;">NA</span>                      0 <span style="color: #BB0000;">NA</span>      <span style="color: #BB0000;">NA</span>            2 <span style="color: #BB0000;">NA</span>                  <span style="color: #BB0000;">NA</span>        </span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># ℹ 22 more rows</span></span></span></code></pre></div>
<p>The top five cells show that the results of formulas are available as
usual in the columns <code>error</code>, <code>logical</code>,
<code>numeric</code>, <code>date</code>, and <code>character</code>.</p>
<div class="section level5">
<h5 id="shared-formulas">Shared formulas<a class="anchor" aria-label="anchor" href="#shared-formulas"></a>
</h5>
<p>Cells <code>A20</code> and <code>A21</code> illustrate how formulas
are normalised before being written to file, using the
<code>formula_ref</code> and <code>formula_group</code> columns. When
there is a group of cells whose formulas only differ by cell reference
(e.g. “=A1+1”, “=A2+1”, “=A3+1”, etc.), only one formula in each group
is written to the file, so <code>tidyxl</code> infers what the formulas
in the other cells in the group must be, from their relative
positions.</p>
</div>
<div class="section level5">
<h5 id="array-formulas">Array formulas<a class="anchor" aria-label="anchor" href="#array-formulas"></a>
</h5>
<p>There are two kinds of array formulas: ones that compute over arrays,
and ones whose output is an array (of cells).</p>
<p>Both kinds are distinguished in spreadsheet programs by curly braces,
e.g. <code>{SUM(A19:A21*B19:B21)}</code>. In <code>tidyxl</code>, the
curly braces are ommitted (as they are from the file itself), and
instead the <code>is_array</code> column has the value
<code>TRUE</code>.</p>
<p>The first kind (those that compute over arrays) is illustrated by
cell <code>A22</code>.</p>
<p>The second kind (those whose value is spread across an array of
cells) is illustrated by cells <code>A23</code> and <code>A24</code>.
The formula is only given in the top-left cell (<code>A23</code>), which
is also the only cell that describes the range of cells containing the
result, in the <code>formula-ref</code> column. The results themselves
are stored in all relevant cells (<code>A23</code> and
<code>A24</code>). Unlike shared formulas, there is no
<code>formula_group</code> to associate the cells of an array formula’s
result. If you need to do identify those cells, use the <a href="https://github.com/rsheets/cellranger" class="external-link">cellranger</a> package and
the <code>formula_ref</code> column.</p>
</div>
<div class="section level5">
<h5 id="formulas-referring-to-other-files">Formulas referring to other files<a class="anchor" aria-label="anchor" href="#formulas-referring-to-other-files"></a>
</h5>
<p>Cell <code>A25</code> contains a formula that refers to another file.
The <code>[1]</code> is an index into a table of files. The roadmap for
<a href="https://github.com/nacnudus/tidyxl" class="external-link">tidyxl</a> includes
de-referencing such numbers.</p>
</div>
<div class="section level5">
<h5 id="tokenizing-formulas">Tokenizing formulas<a class="anchor" aria-label="anchor" href="#tokenizing-formulas"></a>
</h5>
<p>The function <code><a href="../reference/xlex.html">xlex()</a></code> separates formulas into tokens of
different types, and gives their depth within a nested formula. Its name
is a bad pun on ‘Excel’ and ‘lexer’. Try the <a href="https://duncan-garmonsway.shinyapps.io/xlex/" class="external-link">online demo</a> or
install the more experimental <a href="https://nacnudus.github.io/lexl/" class="external-link">lexl</a> package to run
<code>demo_lexl()</code> locally.</p>
<p>It is useful for detecting spreadsheet smells, which are poor
practices in spreadsheet design, such as deep nests of functions, or
embedding constants in formulas.</p>
<div class="sourceCode" id="cb9"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">x</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/xlex.html">xlex</a></span><span class="op">(</span><span class="st">"MIN(3,MAX(2,A1))"</span><span class="op">)</span></span>
<span><span class="va">x</span></span>
<span><span class="co">#&gt; root            </span></span>
<span><span class="co">#&gt; ¦-- MIN         function</span></span>
<span><span class="co">#&gt; °-- (           fun_open</span></span>
<span><span class="co">#&gt;     ¦-- 3       number</span></span>
<span><span class="co">#&gt;     ¦-- ,       separator</span></span>
<span><span class="co">#&gt;     ¦-- MAX     function</span></span>
<span><span class="co">#&gt;     °-- (       fun_open</span></span>
<span><span class="co">#&gt;         ¦-- 2   number</span></span>
<span><span class="co">#&gt;         ¦-- ,   separator</span></span>
<span><span class="co">#&gt;         °-- A1  ref</span></span>
<span><span class="co">#&gt;     °-- )       fun_close</span></span>
<span><span class="co">#&gt; °-- )           fun_close</span></span></code></pre></div>
<p>See the <a href="https://nacnudus.github.io/tidyxl/articles/smells.html">vignette</a>
for more examples and details.</p>
</div>
</div>
<div class="section level4">
<h4 id="named-ranges">Named ranges<a class="anchor" aria-label="anchor" href="#named-ranges"></a>
</h4>
<p>Names are imported with <code><a href="../reference/xlsx_names.html">xlsx_names()</a></code>. Also called ‘named
formulas’ and ‘defined names’, these are usually used to name particular
cells or ranges, making formulas that refer to them more readable. Ones
that <em>are</em> ranges are identifed by the <code>is_range</code>
column (using <code><a href="../reference/is_range.html">is_range()</a></code>), making it easier to match the
names to the cells returned by <code><a href="../reference/xlsx_cells.html">xlsx_cells()</a></code> – e.g. by using
the <a href="https://github.com/rsheets/cellranger" class="external-link"><code>cellranger</code></a>
package.</p>
<p>When the scope of the name is within a particular sheet, rather than
global, the sheet name is given.</p>
<div class="sourceCode" id="cb10"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/xlsx_names.html">xlsx_names</a></span><span class="op">(</span><span class="va">examples</span><span class="op">)</span></span>
<span><span class="co">#&gt;   rId    sheet                 name                     formula    comment hidden is_range</span></span>
<span><span class="co">#&gt; 1   1   Sheet1  named_local_formula MAX(Sheet1!$A$129:$A$130)+1       &lt;NA&gt;  FALSE    FALSE</span></span>
<span><span class="co">#&gt; 2   4 E09904.2   sheet_beyond_chart E09904.2!$A$1,E09904.2!$C$1       &lt;NA&gt;  FALSE     TRUE</span></span>
<span><span class="co">#&gt; 3  NA     &lt;NA&gt;         intersection   Sheet1!$B:$B Sheet1!$8:$8       &lt;NA&gt;  FALSE     TRUE</span></span>
<span><span class="co">#&gt; 4  NA     &lt;NA&gt; named_global_formula             Sheet1!$A$129-1       &lt;NA&gt;  FALSE    FALSE</span></span>
<span><span class="co">#&gt; 5  NA     &lt;NA&gt;          named_range               Sheet1!$A$129 My comment  FALSE     TRUE</span></span></code></pre></div>
</div>
<div class="section level4">
<h4 id="data-validation-rules">Data validation rules<a class="anchor" aria-label="anchor" href="#data-validation-rules"></a>
</h4>
<p>Data validation rules are imported with
<code><a href="../reference/xlsx_validation.html">xlsx_validation()</a></code>. These rules control what values may be
entered into a cell, and are often used to create a drop-down list in a
cell. Read the <a href="https://nacnudus.github.io/tidyxl/articles/data-validation-rules.html">vignette</a>
for details.</p>
<div class="sourceCode" id="cb11"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/xlsx_validation.html">xlsx_validation</a></span><span class="op">(</span><span class="va">examples</span><span class="op">)</span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># A tibble: 15 × 14</span></span></span>
<span><span class="co">#&gt;    sheet  ref            type       operator   formula1 formula2 allow_blank show_input_message prompt_title prompt_body</span></span>
<span><span class="co">#&gt;    <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>  <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>          <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>      <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>      <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>    <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>    <span style="color: #949494; font-style: italic;">&lt;lgl&gt;</span>       <span style="color: #949494; font-style: italic;">&lt;lgl&gt;</span>              <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>        <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>      </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 1</span> Sheet1 A106           whole      between    0        9        TRUE        TRUE               message tit… message bo…</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 2</span> Sheet1 A108           list       <span style="color: #BB0000;">NA</span>         $B$108   <span style="color: #BB0000;">NA</span>       TRUE        TRUE               <span style="color: #BB0000;">NA</span>           <span style="color: #BB0000;">NA</span>         </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 3</span> Sheet1 A110           date       between    2017-01… 2017-01… TRUE        TRUE               <span style="color: #BB0000;">NA</span>           <span style="color: #BB0000;">NA</span>         </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 4</span> Sheet1 A111           time       between    00:00:00 09:00:00 TRUE        TRUE               <span style="color: #BB0000;">NA</span>           <span style="color: #BB0000;">NA</span>         </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 5</span> Sheet1 A112           textLength between    0        9        TRUE        TRUE               <span style="color: #BB0000;">NA</span>           <span style="color: #BB0000;">NA</span>         </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 6</span> Sheet1 A114           whole      notBetween 0        9        TRUE        TRUE               <span style="color: #BB0000;">NA</span>           <span style="color: #BB0000;">NA</span>         </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 7</span> Sheet1 A115,A121:A122 whole      equal      0        <span style="color: #BB0000;">NA</span>       TRUE        TRUE               <span style="color: #BB0000;">NA</span>           <span style="color: #BB0000;">NA</span>         </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 8</span> Sheet1 A116           whole      notEqual   0        <span style="color: #BB0000;">NA</span>       TRUE        TRUE               <span style="color: #BB0000;">NA</span>           <span style="color: #BB0000;">NA</span>         </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 9</span> Sheet1 A117           whole      greaterTh… 0        <span style="color: #BB0000;">NA</span>       TRUE        TRUE               <span style="color: #BB0000;">NA</span>           <span style="color: #BB0000;">NA</span>         </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">10</span> Sheet1 A119           whole      greaterTh… 0        <span style="color: #BB0000;">NA</span>       TRUE        TRUE               <span style="color: #BB0000;">NA</span>           <span style="color: #BB0000;">NA</span>         </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">11</span> Sheet1 A120           whole      lessThanO… 0        <span style="color: #BB0000;">NA</span>       TRUE        TRUE               <span style="color: #BB0000;">NA</span>           <span style="color: #BB0000;">NA</span>         </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">12</span> Sheet1 A118           whole      lessThan   0        <span style="color: #BB0000;">NA</span>       TRUE        TRUE               <span style="color: #BB0000;">NA</span>           <span style="color: #BB0000;">NA</span>         </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">13</span> Sheet1 A107           decimal    notBetween 0        9        FALSE       FALSE              <span style="color: #BB0000;">NA</span>           <span style="color: #BB0000;">NA</span>         </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">14</span> Sheet1 A113           custom     <span style="color: #BB0000;">NA</span>         A113&lt;=L… <span style="color: #BB0000;">NA</span>       TRUE        TRUE               <span style="color: #BB0000;">NA</span>           <span style="color: #BB0000;">NA</span>         </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">15</span> Sheet1 A109           list       <span style="color: #BB0000;">NA</span>         $B$108   <span style="color: #BB0000;">NA</span>       TRUE        TRUE               <span style="color: #BB0000;">NA</span>           <span style="color: #BB0000;">NA</span>         </span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># ℹ 4 more variables: show_error_message &lt;lgl&gt;, error_title &lt;chr&gt;, error_body &lt;chr&gt;, error_symbol &lt;chr&gt;</span></span></span></code></pre></div>
</div>
</div>
<div class="section level3">
<h3 id="philosophy">Philosophy<a class="anchor" aria-label="anchor" href="#philosophy"></a>
</h3>
<p>Information in in many spreadsheets cannot be easily imported into R.
Why?</p>
<p>Most R packages that import spreadsheets have difficulty unless the
layout of the spreadsheet conforms to a strict definition of a ‘table’,
e.g.:</p>
<ul>
<li>observations in rows</li>
<li>variables in columns</li>
<li>a single header row</li>
<li>all information represented by characters, whether textual, logical,
or numeric</li>
</ul>
<p>These rules are designed to eliminate ambiguity in the interpretation
of the information. But most spreadsheeting software relaxes these rules
in a trade of ambiguity for expression via other media:</p>
<ul>
<li>proximity (other than headers, i.e. other than being the first value
at the top of a column)</li>
<li>formatting (colours and borders)</li>
</ul>
<p>Humans can usually resolve the ambiguities with contextual knowledge,
but computers are limited by their ignorance. Programmers are hampered
by:</p>
<ul>
<li>their language’s expressiveness</li>
<li>loss of information in transfer from spreadsheet to programming
library</li>
</ul>
<p>Information is lost when software discards it in order to force the
data into tabular form. Sometimes date formatting is retained, but
mostly formatting is lost, and position has to be inferred again.</p>
<p><a href="https://github.com/nacnudus/tidyxl" class="external-link">tidyxl</a> addresses the
programmer’s problems by not discarding information. It imports the
content, position and formatting of cells, leaving it up to the user to
associate the different forms of information, and to re-encode them in
tabular form without loss. The <a href="https://github.com/nacnudus/unpivotr" class="external-link">unpivotr</a> package has
been developed to assist with that step.</p>
</div>
<div class="section level3">
<h3 id="similar-projects">Similar projects<a class="anchor" aria-label="anchor" href="#similar-projects"></a>
</h3>
<p><a href="https://github.com/nacnudus/tidyxl" class="external-link">tidyxl</a> was
originally derived from <a href="https://github.com/tidyverse/readxl" class="external-link">readxl</a> and still contains
some of the same code, hence it inherits the GPL-3 licence. <a href="https://github.com/tidyverse/readxl" class="external-link">readxl</a> is intended for
importing tabular data with a single row of column headers, whereas <a href="https://github.com/nacnudus/tidyxl" class="external-link">tidyxl</a> is more general,
and less magic.</p>
<p>The <a href="https://github.com/rsheets" class="external-link">rsheets</a> project of
several R packages is in the early stages of importing spreadsheet
information from Excel and Google Sheets into R, manipulating it, and
potentially parsing and processing formulas and writing out to
spreadsheet files. In particular, <a href="https://github.com/rsheets/jailbreakr" class="external-link">jailbreaker</a> attempts to
extract non-tabular data from spreadsheets into tabular structures
automatically via some clever algorithms.</p>
<p><a href="https://github.com/nacnudus/tidyxl" class="external-link">tidyxl</a> differs from
<a href="https://github.com/rsheets" class="external-link">rsheets</a> in scope (<a href="https://github.com/nacnudus/tidyxl" class="external-link">tidyxl</a> will never import
charts, for example), and implementation (<a href="https://github.com/nacnudus/tidyxl" class="external-link">tidyxl</a> is implemented
mainly in C++ and is quite fast, only a little slower than <a href="https://github.com/tidyverse/readxl" class="external-link">readxl</a>). <a href="https://github.com/nacnudus/unpivotr" class="external-link">unpivotr</a> is a package
related to <a href="https://github.com/nacnudus/tidyxl" class="external-link">tidyxl</a> that
provides tools for unpivoting complex and non-tabular data layouts using
I not AI (intelligence, not artificial intelligence). In this way it
corresponds to <a href="https://github.com/rsheets/jailbreakr" class="external-link">jailbreaker</a>, but with a
different philosophy.</p>
</div>
</div>
  </main><aside class="col-md-3"><nav id="toc"><h2>On this page</h2>
    </nav></aside>
</div>



    <footer><div class="pkgdown-footer-left">
  <p></p>
<p>Developed by Duncan Garmonsway.</p>
</div>

<div class="pkgdown-footer-right">
  <p></p>
<p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.0.7.</p>
</div>

    </footer>
</div>

  

  

  </body>
</html>
